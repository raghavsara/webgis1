(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[2269],{782269:(e,o,t)=>{"use strict";t.r(o),t.d(o,{default:()=>I});var i=t(624089),r=t(65792),l=t.n(r),n=t(984596),a=t.n(n),s=t(281763),c=t.n(s),d=t(396026),p=t.n(d);function u(e){let{color:o,opacity:t}=e;const[r,n,a,s]=l()(o).gl();return void 0!==t?new i.Color(r,n,a,t):new i.Color(r,n,a,s)}function h(e,o){var t,i;switch(e){case"polyline":return null===(t=o[e])||void 0===t?void 0:t.positions;case"polygon":return null===(i=o[e])||void 0===i?void 0:i.hierarchy;default:return null}}function f(e){let{color:o,opacity:t,dasharray:r}=e;if((null==r?void 0:r.length)<=0)return u({color:o,opacity:t});const l=r.reduce(((e,o)=>e+o),0);return new i.PolylineDashMaterialProperty({color:u({color:o,opacity:t}),dashLength:l,dashPattern:parseInt(r.map((e=>Math.floor(e/l*16))).map(((e,o)=>p()(e).map((()=>o%2==0?"1":"0")).join(""))).join(""),2)})}function y(e,o,t,r){var l,n;o._msPosition||(o._msPosition=o.position.getValue(i.JulianDate.now()));const a=((e,o)=>{const t=parseFloat(e);if(!isNaN(t)&&c()(t))return t;const i="attribute"===(null==e?void 0:e.type)&&parseFloat(o[e.name]);return!isNaN(i)&&c()(i)?i:null})(t.msHeight,r);if(null===a)return void o.position.setValue(o._msPosition);const s=null==e||null===(l=e.scene)||void 0===l||null===(n=l.globe)||void 0===n?void 0:n.ellipsoid;if(!s)return;const d=s.cartesianToCartographic(o._msPosition);d.height=a,o.position.setValue(s.cartographicToCartesian(d))}function m(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.properties?Object.keys(e.properties).reduce(((o,t)=>{const i=new RegExp(`\\{\\{${t}\\}\\}`,"g");return o.replace(i,e.properties[t]??"")}),o):o}const g=["billboard","box","corridor","cylinder","ellipse","ellipsoid","label","model","tileset","path","plane","point","polygon","polyline","polylineVolume","rectangle","wall"],v={none:"NONE",relative:"RELATIVE_TO_GROUND",clamp:"CLAMP_TO_GROUND"};function b(){let{rules:e=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{images:o=[],getImageIdFromSymbolizer:t,geoStylerStyleFilter:r=(()=>!0)}=arguments.length>1?arguments[1]:void 0;return l=>{let{entities:n,map:s,opacity:c=1}=l;n.forEach((e=>{let o={};g.forEach((t=>{e._msStoredCoordinates||(o[t]=h(t,e)||void 0),e[t]=void 0})),e._msStoredCoordinates||(e._msStoredCoordinates=o)})),e.forEach((e=>{e.symbolizers.forEach((l=>{n.forEach((n=>{var d;const p=(null==n||null===(d=n.properties)||void 0===d?void 0:d.getValue(i.JulianDate.now()))||{};if(!e.filter||r({properties:p||{}},e.filter)){if("Mark"===l.kind&&n.position){const{image:e,width:r,height:a}=o.find((e=>{let{id:o}=e;return o===t(l)}))||{};if(e){const o=r>a?r:a,t=2*l.radius/o;n.billboard=new i.BillboardGraphics({image:e,scale:t,rotation:i.Math.toRadians(-1*l.rotate||0),disableDepthTestDistance:l.msBringToFront?Number.POSITIVE_INFINITY:0,heightReference:i.HeightReference[v[l.msHeightReference]||"NONE"],color:u({color:"#ffffff",opacity:1*c})}),y(s,n,l,p)}}if("Icon"===l.kind&&n.position){const{image:e,width:r,height:a}=o.find((e=>{let{id:o}=e;return o===t(l)}))||{};if(e){const o=r>a?r:a,t=l.size/o;n.billboard=new i.BillboardGraphics({image:e,scale:t,rotation:i.Math.toRadians(-1*l.rotate||0),disableDepthTestDistance:l.msBringToFront?Number.POSITIVE_INFINITY:0,heightReference:i.HeightReference[v[l.msHeightReference]||"NONE"],color:u({color:"#ffffff",opacity:l.opacity*c})}),y(s,n,l,p)}}var h,g;"Line"===l.kind&&n._msStoredCoordinates.polyline&&(n.polyline=new i.PolylineGraphics({material:null!=l&&l.dasharray?f({color:l.color,opacity:l.opacity*c,dasharray:l.dasharray}):u({color:l.color,opacity:l.opacity*c}),width:l.width,positions:n._msStoredCoordinates.polyline,clampToGround:l.msClampToGround})),"Fill"===l.kind&&n._msStoredCoordinates.polygon&&(n.polygon=new i.PolygonGraphics({material:u({color:l.color,opacity:l.fillOpacity*c}),hierarchy:n._msStoredCoordinates.polygon,classificationType:"terrain"===l.msClassificationType?i.ClassificationType.TERRAIN:"3d"===l.msClassificationType?i.ClassificationType.CESIUM_3D_TILE:i.ClassificationType.BOTH}),l.outlineColor&&0!==l.outlineWidth&&(n.polyline=new i.PolylineGraphics({material:u({color:l.outlineColor,opacity:l.outlineOpacity*c}),width:l.outlineWidth,positions:n._msStoredCoordinates.polygon.getValue().positions,clampToGround:l.msClampToGround}))),"Text"===l.kind&&n.position&&(n.label=new i.LabelGraphics({text:m({properties:p},l.label),font:[l.fontStyle,l.fontWeight,`${l.size}px`,a()(l.font||["serif"]).join(", ")].filter((e=>e)).join(" "),fillColor:u({color:l.color,opacity:1*c}),heightReference:i.HeightReference[v[l.msHeightReference]||"NONE"],pixelOffset:new i.Cartesian2((null==l||null===(h=l.offset)||void 0===h?void 0:h[0])??0,(null==l||null===(g=l.offset)||void 0===g?void 0:g[1])??0),outlineColor:u({color:l.haloColor,opacity:1*c}),outlineWidth:l.haloWidth}),y(s,n,l,p))}}))}))}))}}const I=class{constructor(){let{drawIcons:e,getImageIdFromSymbolizer:o,geoStylerStyleFilter:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._drawIcons=e||(()=>Promise.resolve(null)),this._getImageIdFromSymbolizer=o||(e=>e.symbolizerId),this._geoStylerStyleFilter=t||(()=>!0)}readStyle(){return new Promise(((e,o)=>{try{e(null)}catch(e){o(e)}}))}writeStyle(e){var o=this;return new Promise(((t,i)=>{try{this._drawIcons(e).then((function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const r=b(e,{images:i,getImageIdFromSymbolizer:o._getImageIdFromSymbolizer,geoStylerStyleFilter:o._geoStylerStyleFilter});t(r)}))}catch(e){i(e)}}))}}},540098:e=>{var o=Math.ceil,t=Math.max;e.exports=function(e,i,r,l){for(var n=-1,a=t(o((i-e)/(r||1)),0),s=Array(a);a--;)s[l?a:++n]=e,e+=r;return s}},747445:(e,o,t)=>{var i=t(540098),r=t(816612),l=t(418601);e.exports=function(e){return function(o,t,n){return n&&"number"!=typeof n&&r(o,t,n)&&(t=n=void 0),o=l(o),void 0===t?(t=o,o=0):t=l(t),n=void 0===n?o<t?1:-1:l(n),i(o,t,n,e)}}},396026:(e,o,t)=>{var i=t(747445)();e.exports=i}}]);