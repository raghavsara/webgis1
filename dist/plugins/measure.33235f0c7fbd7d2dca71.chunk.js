(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[7706],{768977:(e,t,a)=>{"use strict";a.d(t,{Z:()=>d});var l=a(45697),o=a.n(l),n=a(124852),r=a.n(n),s=a(630294),m=a(222777);function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},p.apply(this,arguments)}function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class c extends r().Component{render(){const{cardComponent:e,items:t,colProps:a,onItemClick:l,size:o}=this.props,n=e||m.Z;return r().createElement("div",{className:"msSideGrid"+(this.props.className?" "+this.props.className:"")},r().createElement(s.Row,{className:"items-list"},t.map(((e,t)=>r().createElement(s.Col,p({key:e.id||t},a),r().createElement(n,p({onClick:function(){for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return l(e,...a)},size:o},e)))))))}}i(c,"propTypes",{size:o().string,onItemClick:o().func,colProps:o().object,items:o().array,cardComponent:o().oneOfType([o().string,o().func]),className:o().string}),i(c,"defaultProps",{size:"",onItemClick:()=>{},colProps:{xs:12},className:"",items:[]});const d=c},51427:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Ee});var l={};a.r(l),a.d(l,{clearMapTemplatesEpic:()=>se,mergeTemplateEpic:()=>ie,openMapTemplatesEpic:()=>de,openMapTemplatesPanelEpic:()=>me,replaceTemplateEpic:()=>ce,setAllowedTemplatesEpic:()=>pe});var o=a(124852),n=a.n(o),r=a(227361),s=a.n(r),m=a(171703),p=a(630294),i=a(22222),c=a(152543),d=a(687753),u=a(27908);const g=e=>e.maptemplates&&e.maptemplates.templates,f=(0,i.P1)((e=>e.maptemplates&&e.maptemplates.allowedTemplates),u.zU,((e,t)=>e&&e.length>0?e:t||[]));var T=a(203842),b=a(804504),v=a(89518),h=a(756435),E=a(768977),y=a(8204),w=a(603754),O=a(16246),C=a(141919),S=a(486234),M=a(475897);const Z=(0,S.Z)("filterPlaceholder")(w.Z),I=(0,C.Z)((e=>{let{items:t=[]}=e;return 0===t.length}),(e=>{let{totalTemplateCount:t}=e;return{glyph:t?"filter":"ban-circle",title:n().createElement(b.Z,{msgId:t?"mapTemplates.emptyTitle":"mapTemplates.noTemplatesTitle"}),description:n().createElement(b.Z,{msgId:t?"mapTemplates.emptyDescription":"mapTemplates.noTemplatesDescription"})}}))((e=>{let{items:t=[],favouriteItems:a=[]}=e;const l=n().createElement("div",{className:"map-templates-favourites"},n().createElement("h4",null,n().createElement(b.Z,{msgId:"mapTemplates.favouritesTitle"})),n().createElement(E.Z,{size:"sm",items:a}),n().createElement("hr",null));return n().createElement(n().Fragment,null,a.length>0?l:null,n().createElement("div",{className:"map-templates-all"},a.length>0?n().createElement("h4",null,n().createElement(b.Z,{msgId:"mapTemplates.allTitle"})):null,n().createElement(E.Z,{items:t})))})),k=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return["name","description"].map((e=>t[e])).map((function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return-1!==t.toLowerCase().indexOf(e.toLowerCase())})).reduce(((e,t)=>e||t),!1)},x=e=>{let{templates:t=[],onMergeTemplate:a=(()=>{}),onReplaceTemplate:l=(()=>{}),onToggleFavourite:r=(()=>{})}=e;const[s,m]=(0,o.useState)(""),[i,c]=(0,o.useState)(),[d,u]=(0,o.useState)(!1),g=(e,t)=>({template:e,title:e.name,description:e.description,loading:e.loading,style:{pointerEvents:"none"},preview:n().createElement("div",{className:"map-templates-preview"},e.thumbnail&&"NODATA"!==e.thumbnail?n().createElement("img",{src:decodeURIComponent(e.thumbnail)}):n().createElement(p.Glyphicon,{glyph:"1-map"})),infoExtra:e.format&&n().createElement("div",{className:"map-templates-formaticon"+(t?" map-templates-favourite":"")},n().createElement(p.Glyphicon,{glyph:M.Th[e.format]}),n().createElement("span",null,M.Nk[e.format])),tools:n().createElement(y.Z,{btnDefaultProps:{className:"square-button-md"},buttons:[{glyph:"transfer",bsStyle:"primary",tooltipId:"mapTemplates.transfer",onClick:t=>{t.stopPropagation(),c(e),u(!0)}},{glyph:"plus",bsStyle:"primary",tooltipId:"mapTemplates.merge",onClick:t=>{t.stopPropagation(),a(e.id,e.data)}},{glyph:e.favourite?"star":"star-empty",className:"square-button-md no-border",tooltipId:e.favourite?"mapTemplates.favouriteRemove":"mapTemplates.favouriteAdd",onClick:t=>{t.stopPropagation(),r(e.id)}}]})}),f=t.slice().sort(((e,t)=>e.name>t.name?1:e.name===t.name?0:-1)).filter(k.bind(null,s)),T=f.map((e=>g(e,!1))),v=f.filter((e=>e.favourite)).map((e=>g(e,!0)));return n().createElement(n().Fragment,null,n().createElement(h.Z,{className:"map-templates-panel",header:n().createElement("div",{style:{padding:"8px 15px"}},n().createElement(Z,{filterPlaceholder:"mapTemplates.filterPlaceholder",filterText:s,onFilter:m}))},n().createElement(I,{totalTemplateCount:t.length,items:T,favouriteItems:v})),n().createElement(O.Z,{modal:!0,show:d,title:n().createElement(b.Z,{msgId:"mapTemplates.confirmReplaceTitle"}),onClose:()=>{c(),u(!1)},onConfirm:()=>{l(i.id,i.data),c(),u(!1)},confirmButtonBSStyle:"default",confirmButtonContent:n().createElement(b.Z,{msgId:"mapTemplates.confirmReplaceConfirmButton"}),closeText:n().createElement(b.Z,{msgId:"cancel"}),closeGlyph:"1-close"},n().createElement(b.Z,{msgId:"mapTemplates.confirmReplaceMessage"})))};var L=a(521923),N=a(49977),P=a(478718),z=a.n(P),R=a(957557),A=a.n(R),D=a(513218),F=a.n(D),j=a(747037),B=a.n(j),G=a(701469),H=a.n(G),U=a(313311),X=a.n(U),$=a(150361),_=a.n($),q=a(835516),V=a(288287),J=a(504518),Q=a(510644),K=a(274363),W=a(612912),Y=a(4143),ee=a(57677),te=a(945395),ae=a(926854),le=a(426529),oe=a(501797),ne=a(917450);const re=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{},a="context.errors.template.unknownError";return 403===e.status&&(a="context.errors.template.pleaseLogin",(0,Q.jl)(t())&&(a="context.errors.template.notAccessible")),404===e.status&&(a="context.errors.template.notFound"),a},se=e=>e.ofType(T.Ef).switchMap((()=>N.Observable.of((0,d.Xg)("mapTemplates","enabled",!1,!1)))),me=e=>e.ofType(T.pu).switchMap((()=>N.Observable.of((0,d.Xg)("mapTemplates","enabled",!0,!0)))),pe=(e,t)=>e.ofType(T.b9).switchMap((()=>{const e=t.getState(),a=f(e),l=e=>{const t=s()(e,"Attributes.attribute",{});return(H()(t)?t:[t]).reduce(((e,t)=>({...e,[t.name]:t.value})),{})};return a.length>0?N.Observable.defer((()=>V.Z.searchListByAttributes({OR:{FIELD:a.map((e=>({field:["ID"],operator:["EQUAL_TO"],value:[e.id]})))}},{params:{includeAttributes:!0}},"/resources/search/list"))).switchMap((e=>{const t=s()(e,"ResourceList.Resource",[]),a=(H()(t)?t:[t]).map((e=>({...z()(e,"id","name","description"),...l(e),dataLoaded:!1,loading:!1})));return N.Observable.of((0,T.T3)(a),(0,T.Sy)(!0))})).catch((e=>N.Observable.of((0,T.Sy)(!0,e)))):N.Observable.of((0,T.T3)([]),(0,T.Sy)(!0))})),ie=(e,t)=>e.ofType(T.JV).switchMap((e=>{let{id:a}=e;const l=t.getState(),o=g(l),n=X()(o,(e=>e.id===a));return(n.dataLoaded?N.Observable.of(n.data):N.Observable.defer((()=>V.Z.getData(a)))).switchMap((e=>{if(F()(e)&&void 0!==e.map||B()(e)){const t=(0,K.Od)(l),o=(0,W.l2)(l),r=(0,W.Bt)(l),s=(0,Y.Mz)(l),m=(0,ee.I)(l),p=(0,ee._)(l),i=(0,te.UC)(l),c=q.default.saveMapConfiguration(t,o,r,s,m,p,i);return(B()(e)?N.Observable.defer((()=>(0,oe.H)(e,!1))):N.Observable.of(e)).switchMap((t=>N.Observable.of(...n.dataLoaded?[]:[(0,T.mS)(a,e)],(0,ae.H0)(_()(A()(q.default.mergeMapConfigs(c,q.default.addRootParentGroup(t,n.name)),"widgetsConfig")),null))))}return n.dataLoaded?N.Observable.empty():N.Observable.of((0,T.mS)(a,e))})).let((0,le.hP)((0,T.D$)(a,!0),(0,T.D$)(a,!1),(e=>{const a=re(e.originalError||e,t.getState);return N.Observable.of((0,J.vU)({title:"context.errors.template.title",message:a,position:"tc",autoDismiss:5}))})))})),ce=(e,t)=>e.ofType(T.ef).switchMap((e=>{let{id:a}=e;const l=t.getState(),o=g(l),n=X()(o,(e=>e.id===a)),{zoom:r,center:s}=(0,K.Od)(l);return(n.dataLoaded?N.Observable.of(n.data):N.Observable.defer((()=>V.Z.getData(a)))).switchMap((e=>(B()(e)?N.Observable.defer((()=>(0,oe.H)(e))):N.Observable.of(F()(e)&&void 0!==e.map?e:null)).switchMap((t=>N.Observable.of(...n.dataLoaded?[]:[(0,T.mS)(a,e)],...t?[(0,ae.H0)(_()({...t,map:{...t.map,zoom:t.map.zoom||r,center:t.map.center||s}}),null,!t.map.zoom&&(t.map.bbox||t.map.maxExtent))]:[]))))).let((0,le.hP)((0,T.D$)(a,!0),(0,T.D$)(a,!1),(e=>{const a=re(e.originalError||e,t.getState);return N.Observable.of((0,J.vU)({title:"context.errors.template.title",message:a,position:"tc",autoDismiss:5}))})))})),de=(e,t)=>e.ofType(d.At,d.kM).filter((e=>{return"mapTemplates"===e.control&&(a=t.getState(),s()(a,"controls.mapTemplates.enabled"));var a})).switchMap((()=>N.Observable.of((0,ne.g)(),(0,ne.aN)())));var ue=a(350126),ge=a(45697),fe=a.n(ge),Te=a(908316);function be(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ve extends n().Component{componentDidUpdate(e){const{active:t,allowedTemplates:a,onSetAllowedTemplates:l}=this.props,{active:o}=e;t!==o&&t&&l(a)}render(){const{active:e,templates:t,templatesLoaded:a,onToggleControl:l,onMergeTemplate:o,onReplaceTemplate:r,onToggleFavourite:s,dockStyle:m,size:p}=this.props;return n().createElement(Te.Z,{containerStyle:m,containerId:"map-templates-container",containerClassName:"dock-container",className:"map-templates-dock-panel",open:e,position:"right",size:p,bsStyle:"primary",title:n().createElement(b.Z,{msgId:"mapTemplates.title"}),style:m,onClose:l},!a&&n().createElement("div",{className:"map-templates-loader"},n().createElement(v.Z,{size:352})),a&&n().createElement(x,{templates:t,onMergeTemplate:o,onReplaceTemplate:r,onToggleFavourite:s}))}}be(ve,"propTypes",{active:fe().bool,templatesLoaded:fe().bool,templates:fe().array,allowedTemplates:fe().array,dockStyle:fe().object,onToggleControl:fe().func,onMergeTemplate:fe().func,onReplaceTemplate:fe().func,onToggleFavourite:fe().func,onSetAllowedTemplates:fe().func,size:fe().number}),be(ve,"defaultProps",{active:!1,templatesLoaded:!1,templates:[],allowedTemplates:[],dockStyle:{},onToggleControl:()=>{},onMergeTemplate:()=>{},onReplaceTemplate:()=>{},onToggleFavourite:()=>{},onSetAllowedTemplates:()=>{},size:550});const he=(0,m.connect)((0,i.P1)((e=>(0,ue.ic)(e,{height:!0,right:!0},!0)),(e=>s()(e,"controls.mapTemplates.enabled")),g,(e=>e.maptemplates&&e.maptemplates.mapTemplatesLoaded),((e,t,a,l)=>({active:t,templates:a,templatesLoaded:l,dockStyle:e}))),{onToggleControl:d.Xi.bind(null,"mapTemplates","enabled"),onMergeTemplate:T.jl,onReplaceTemplate:T.xt,onToggleFavourite:T.pL,onSetAllowedTemplates:T.B7})(ve),Ee=(0,c.rx)("MapTemplates",{component:he,containers:{BurgerMenu:{name:"MapTemplates",position:998,text:n().createElement(b.Z,{msgId:"mapTemplates.title"}),icon:n().createElement(p.Glyphicon,{glyph:"1-map"}),action:T.nF,priority:2,doNotHide:!0,tooltip:n().createElement(b.Z,{msgId:"mapTemplates.tooltip"})},SidebarMenu:{name:"mapTemplates",position:998,text:n().createElement(b.Z,{msgId:"mapTemplates.title"}),icon:n().createElement(p.Glyphicon,{glyph:"1-map"}),action:d.Xg.bind(null,"mapTemplates","enabled",!0,!0),toggle:!0,priority:1,doNotHide:!0,tooltip:"mapTemplates.tooltip"}},reducers:{maptemplates:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case T.Ef:return{};case T.N_:return(0,L.t8)("templates",t.templates,e);case T.b9:return(0,L.t8)("allowedTemplates",t.templates,e);case T.ip:{const a=s()(e,"templates",[]).map((e=>e.id===t.id?{...e,favourite:!e.favourite}:e));return(0,L.t8)("templates",a,e)}case T.kP:{const a=s()(e,"templates",[]).map((e=>e.id===t.id?{...e,data:t.data,dataLoaded:!0}:e));return(0,L.t8)("templates",a,e)}case T.iF:{const a=s()(e,"templates",[]).map((e=>e.id===t.id?{...e,loading:t.loadingValue}:e));return(0,L.t8)("templates",a,e)}case T.cH:return(0,L.t8)("mapTeplatesLoadError",t.error,(0,L.t8)("mapTemplatesLoaded",t.loaded,e));default:return e}}},epics:l})}}]);