(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[8098],{52855:(e,t,a)=>{"use strict";a.d(t,{Z:()=>s});var o=a(124852),l=a.n(o),r=a(630294);const n=(0,a(486234).Z)("placeholder")(r.FormControl),s=e=>{let{onSearchTextChange:t=(()=>{}),searchText:a,title:o,subTitle:s=null}=e;return l().createElement(r.Grid,{className:"catalog-form",fluid:!0},l().createElement(r.Row,null,l().createElement(r.Col,{xs:12},o&&l().createElement("h4",{className:"text-center"},o),s,l().createElement(r.FormGroup,{controlId:"catalog-form"},l().createElement(n,{type:"text",placeholder:"catalog.textSearchPlaceholder",value:a,onChange:e=>t(e.currentTarget.value)})))))}},768977:(e,t,a)=>{"use strict";a.d(t,{Z:()=>m});var o=a(45697),l=a.n(o),r=a(124852),n=a.n(r),s=a(630294),i=a(222777);function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},c.apply(this,arguments)}function p(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class d extends n().Component{render(){const{cardComponent:e,items:t,colProps:a,onItemClick:o,size:l}=this.props,r=e||i.Z;return n().createElement("div",{className:"msSideGrid"+(this.props.className?" "+this.props.className:"")},n().createElement(s.Row,{className:"items-list"},t.map(((e,t)=>n().createElement(s.Col,c({key:e.id||t},a),n().createElement(r,c({onClick:function(){for(var t=arguments.length,a=new Array(t),l=0;l<t;l++)a[l]=arguments[l];return o(e,...a)},size:l},e)))))))}}p(d,"propTypes",{size:l().string,onItemClick:l().func,colProps:l().object,items:l().array,cardComponent:l().oneOfType([l().string,l().func]),className:l().string}),p(d,"defaultProps",{size:"",onItemClick:()=>{},colProps:{xs:12},className:"",items:[]});const m=d},890032:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});var o=a(867076);const l=a(49977),r=function(e,t,a){let{dataProp:o="items",initialStreamDebounce:r=0,throttleTime:n=500}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e.take(1).concat(e.debounceTime(r)).switchMap((e=>a(e,0).startWith({loading:!0}).concat(l.Observable.of({loading:!1})).concat(t.throttleTime(n).distinct().exhaustMap((t=>a(e,t).startWith({loading:!0}).concat(l.Observable.of({loading:!1}))))).scan(((e,t)=>{let{[o]:a,...l}=e,{[o]:r,...n}=t;return{[o]:r?[...a||[],...r]:a||[],...l,...n}})).map((e=>({...e}))))).catch((e=>l.Observable.of({loading:!1,error:e})))},n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>l.Observable.empty(),t=arguments.length>1?arguments[1]:void 0;return(0,o.mapPropsStream)((a=>{const{handler:l,stream:n}=(0,o.createEventHandler)(),{handler:s,stream:i}=(0,o.createEventHandler)();return a.combineLatest(r(i,n,e,t).startWith({}),((e,t)=>({...e,...t,onLoadMore:l,loadFirst:s})))}))}},185936:(e,t,a)=>{"use strict";a.d(t,{Z:()=>n});var o=a(890032),l=a(867076),r=a(274335);const n=e=>{let{loadPage:t,scrollSpyOptions:a,loadStreamOptions:n,loadMoreStreamOptions:s,hasMore:i,isScrolled:c}=e;return(0,l.compose)((0,o.Z)(t,s),(0,l.defaultProps)({hasMore:i,isScrolled:c}),(0,r.Z)(a,n))}},274335:(e,t,a)=>{"use strict";a.d(t,{Z:()=>p});var o=a(124852),l=a.n(o),r=a(45697),n=a.n(r),s=a(180307),i=a.n(s);function c(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a(49977);const p=function(){let{dataProp:e="items",querySelector:t,closest:a=!1,loadingProp:o="loading",skip:r=0,pageSize:s=10,offsetSize:p=200}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return d=>{var m;return m=class extends l().Component{constructor(){super(...arguments),c(this,"findScrollDomNode",(()=>{if(!this.isMounded)return null;let e=i().findDOMNode(this);return e&&a&&t?e.closest(t||"*"):e&&(t?e.querySelector(t):e)})),c(this,"onScroll",(()=>{const t={skip:r,pageSize:s,offsetSize:p,...this.props.scrollOptions},a=this.findScrollDomNode();a&&this.props.isScrolled({div:a,offset:t.offsetSize})&&(!e||this.props[e]&&this.props[e].length)&&(!o||!this.props[o])&&this.props.hasMore(this.props)&&this.props.onLoadMore(e?Math.ceil((this.props[e].length-t.skip)/t.pageSize):null)}))}componentDidMount(){this.isMounded=!0;const e=this.findScrollDomNode();e&&(this.listenerAdded=!0,e.addEventListener("scroll",this.onScroll,!1),this.onScroll())}componentDidUpdate(t){const a=this.findScrollDomNode();a&&!this.listenerAdded&&(a.addEventListener("scroll",this.onScroll,!1),this.listenerAdded=!0),!a||e&&this.props[e]&&this.props[e]===t[e]||setTimeout((()=>this.onScroll()),300)}componentWillUnmount(){this.isMounded=!1,this.listenerAdded=!1;const e=this.findScrollDomNode();e&&e.removeEventListener("scroll",this.onScroll,!1)}render(){return l().createElement(d,this.props)}},c(m,"propTypes",{hasMore:n().func,onLoadMore:n().func,isScrolled:n().func,scrollOptions:n().object}),c(m,"defaultProps",{onLoadMore:()=>{},hasMore:()=>!0,isScrolled:e=>{let{div:t,offset:a}=e;return t.scrollTop+t.clientHeight>=t.scrollHeight-a}}),m}}},994074:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>he});var o={};a.r(o),a.d(o,{deleteMapEpic:()=>ie,openMapCatalogEpic:()=>pe,saveMapEpic:()=>ce});var l=a(124852),r=a.n(l),n=a(630294),s=a(171703),i=a(22222),c=a(687753);const p="MAPCATALOG:DELETE_MAP",d="MAPCATALOG:SAVE_MAP",m="MAPCATALOG:SET_FILTER_RELOAD_DELAY",u="MAPCATALOG:TRIGGER_RELOAD",g=e=>({type:m,delay:e}),h=()=>({type:u});var f=a(510644),b=a(101092),v=a(227361),y=a.n(v),C=a(45697),S=a.n(C),E=a(49977),T=a.n(E),O=a(701469),M=a.n(O),P=a(604788),D=a.n(P),x=a(471640),R=a.n(x),w=a(414293),N=a.n(w),Z=a(838169),A=a.n(Z),k=a(867076),I=a(679426),j=a(288287),L=a(185936),z=a(770165);function F(){return F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},F.apply(this,arguments)}var G=a(804504),V=a(16246);function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},H.apply(this,arguments)}var B=a(130609);function $(){return $=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(e[o]=a[o])}return e},$.apply(this,arguments)}const _=(0,a(626365).Z)(B.Z);var q=a(719648),U=a(8204),W=a(603754),X=a(756435),Y=a(141919),J=a(554155),K=a(52713),Q=a(52855);const ee=(0,k.compose)((0,J.Z)((e=>{let{loading:t,items:a=[]}=e;return 0===a.length&&t})),(0,Y.Z)((e=>{let{loading:t,items:a=[]}=e;return 0===a.length&&!t}),{title:r().createElement(G.Z,{msgId:"catalog.noRecordsMatched"}),style:{transform:"translateY(50%)"}}))(a(768977).Z),te=e=>{let{setSearchText:t=(()=>{}),selected:a,skip:o=0,onSelected:l,loading:n,searchText:s,items:i=[],loaderProps:c={},total:p,header:d,title:m=r().createElement(G.Z,{msgId:"maps.title"})}=e;return r().createElement(X.Z,{className:"map-catalog",header:d||r().createElement(Q.Z,{title:m,searchText:s,onSearchTextChange:t}),footer:r().createElement("div",{className:"catalog-footer"},n&&i.length>0?r().createElement(K.Z,null):null,N()(p)?null:r().createElement("span",{className:"res-info"},r().createElement(G.Z,{msgId:"catalog.pageInfoInfinite",msgParams:{loaded:i.length-o,total:p}})))},r().createElement(ee,{loaderProps:c,items:i.map((e=>e===a||a&&e&&e.map&&a.id===e.map.id?{...e,selected:!0}:e)),loading:n,onItemClick:function(){let{map:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return l(e)}}))},ae=e=>{let{searchText:t,opts:a}=e;return T().Observable.defer((()=>j.Z.getResourcesByCategory("MAP",t||"*",a))).switchMap((e=>(e=>{let{results:t,...a}=e;const o=M()(t)?t:""===t?[]:[t];return 0===o.length?T().Observable.of({results:t,...a}):T().Observable.forkJoin(o.map((e=>{let{context:t}=e;return t?(0,I.RX)(t,{includeAttributes:!1,withData:!1,withPermissions:!1}).switchMap((e=>T().Observable.of(e.name))).catch((()=>T().Observable.of(null))):T().Observable.of(null)}))).map((e=>({results:D()(o,e).map((e=>{let[t,a]=e;return{...t,contextName:a}})),...a})))})(e))).map((e=>({items:e.results,total:e.totalCount,loading:!1}))).catch((()=>T().Observable.of({items:[],total:0,loading:!1})))},oe=(0,k.compose)((0,k.getContext)({messages:S().object,router:S().object}),(0,L.Z)({loadPage:function(){let{searchText:e="",limit:t=12}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return ae({searchText:e,opts:{params:{includeAttributes:!0,start:a*t,limit:t}}})},loadMoreStreamOptions:{initialStreamDebounce:300},scrollSpyOptions:{querySelector:".map-catalog-panel > .map-catalog > .ms2-border-layout-body",pageSize:12},hasMore:e=>{let{items:t=[],total:a=0}=e;return t.length<a}}),(e=>t=>{let{triggerReloadValue:a=!1,filterReloadDelay:o=0,setFilterReloadDelay:l=(()=>{}),onTriggerReload:n=(()=>{}),loadFirst:s=(()=>{}),...i}=t;const[c,p]=r().useState("");return r().useEffect((()=>{setTimeout((()=>{s({searchText:c})}),o||0)}),[c,a,s]),r().createElement(e,F({},i,{filterText:c,onFilter:(e,t)=>{l(t),p(e)},onReloadFilter:e=>{l(e),n()}}))}),(e=>t=>{let{onDelete:a=(()=>{}),...o}=t;const[l,n]=r().useState(!1),[s,i]=r().useState();return r().createElement(r().Fragment,null,r().createElement(e,H({},o,{onDelete:e=>{i(e),n(!0)}})),r().createElement(V.Z,{draggable:!1,modal:!0,show:l,onClose:()=>{i(),n(!1)},onConfirm:()=>{n(!1),a(s),i()},confirmButtonBSStyle:"default",confirmButtonContent:r().createElement(G.Z,{msgId:"confirm"}),closeText:r().createElement(G.Z,{msgId:"cancel"}),closeGlyph:"1-close"},r().createElement(G.Z,{msgId:"mapCatalog.deleteConfirmContent",msgParams:{mapName:null==s?void 0:s.name}})))}),(e=>t=>{let{user:a,saveDialogTitle:o="resources.resource.editResource",onSave:l=(()=>{}),...n}=t;const[s,i]=r().useState(!1),[c,p]=r().useState();return r().createElement(r().Fragment,null,r().createElement(e,$({},n,{onEdit:e=>{p(e),i(!0)}})),r().createElement(_,{show:s,user:a,resource:c&&{...c,...c.thumbnail?{attributes:{...c.attributes||{},thumbnail:c.thumbnail,context:c.context}}:{}},clickOutEnabled:!1,category:"MAP",title:o,onSave:e=>{l(e),p(),i(!1)},onClose:()=>{p(),i(!1)}}))}),z.Z)((e=>{let{loading:t,mapType:a,items:o=[],filterText:l,onFilter:s=(()=>{}),onDelete:i=(()=>{}),onEdit:c=(()=>{}),onShare:p=(()=>{}),messages:d={},router:m={},toggleCatalog:u=(()=>{}),reloadFunction:g=A()(window.location.reload,window.location)}=e;return r().createElement("div",{className:"map-catalog-panel"},r().createElement(te,{loading:t,loaderProps:{width:480,height:480},header:r().createElement(W.Z,{filterText:l,filterPlaceholder:(0,q.S$)(d,"mapCatalog.filterPlaceholder"),onFilter:s}),items:o.map((e=>({title:e.name,description:e.description,tools:r().createElement(U.Z,{btnDefaultProps:{className:"square-button-md"},buttons:[{glyph:"trash",bsStyle:"primary",tooltipId:"mapCatalog.tooltips.delete",visible:e.canDelete,onClick:t=>{t.stopPropagation(),i(e)}},{glyph:"wrench",bsStyle:"primary",tooltipId:"mapCatalog.tooltips.edit",visible:e.canEdit,onClick:t=>{t.stopPropagation(),c(e)}},{glyph:"share-alt",bsStyle:"primary",className:"square-button-md",tooltipId:"mapCatalog.tooltips.share",onClick:t=>{t.stopPropagation(),p(e)}}]}),preview:r().createElement("div",{className:"map-catalog-preview"},e.thumbnail&&"NODATA"!==e.thumbnail?r().createElement("img",{src:decodeURIComponent(e.thumbnail)}):r().createElement(n.Glyphicon,{glyph:"1-map"})),onClick:()=>((e,t,a,o,l)=>{o();const{location:r}=t.history;N()(r.pathname)||e.contextName!==R()(r.pathname,"/")[2]||e.id!==Number(R()(r.pathname,"/")[3])?t.history.push(e.contextName?"/context/"+e.contextName+"/"+e.id:"/viewer/"+a+"/"+e.id):l()})(e,m,a,u,g)})))}))}));var le=a(152543),re=a(521923),ne=a(425589),se=a(917450);const ie=e=>e.ofType(p).switchMap((e=>{let{resource:t}=e;return(0,I.fg)(t).switchMap((()=>T().Observable.of((0,ne.c)({title:"mapCatalog.deletedMap.title",message:"mapCatalog.deletedMap.message",autoDismiss:6,position:"tc"}),g(700),h()))).catch((()=>T().Observable.of((0,ne.d)({message:"mapCatalog.deleteError"}))))})),ce=e=>e.ofType(d).switchMap((e=>{let{resource:t}=e;return(0,I.id)(t).switchMap((()=>T().Observable.of((0,ne.c)({title:"mapCatalog.updatedMap.title",message:"mapCatalog.updatedMap.message",autoDismiss:6,position:"tc"}),g(700),h()))).catch((()=>T().Observable.of((0,ne.d)({message:"mapCatalog.updateError"}))))})),pe=(e,t)=>e.ofType(c.At,c.kM).filter((e=>{return"mapCatalog"===e.control&&(a=t.getState(),y()(a,"controls.mapCatalog.enabled"));var a})).switchMap((()=>T().Observable.of((0,se.g)(),(0,se.aN)())));var de=a(350126),me=a(908316);function ue(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ge extends r().Component{render(){const{allow3d:e,active:t,mapType:a,user:o,triggerReloadValue:l,filterReloadDelay:n,onToggleControl:s,onTriggerReload:i,onDelete:c,onSave:p,dockStyle:d,size:m,...u}=this.props;return r().createElement(me.Z,{containerStyle:d,containerId:"map-catalog-container",containerClassName:"dock-container",className:"map-catalog-dock-panel",open:t,position:"right",size:m,bsStyle:"primary",glyph:"maps-catalog",title:r().createElement(G.Z,{msgId:"mapCatalog.title"}),onClose:()=>s(),style:d},r().createElement(oe,{mapType:a,user:o,triggerReloadValue:l,filterReloadDelay:n,setFilterReloadDelay:u.setFilterReloadDelay,onTriggerReload:i,onDelete:c,onSave:p,getShareUrl:e=>e.contextName?`context/${e.contextName}/${e.id}`:`viewer/${a}/${e.id}`,toggleCatalog:()=>s(),shareApi:!0}))}}ue(ge,"propTypes",{allow3d:C.any,active:C.any,mapType:C.any,user:C.any,triggerReloadValue:C.any,filterReloadDelay:C.any,onToggleControl:C.func,onTriggerReload:C.func,onDelete:C.func,onSave:C.func,dockStyle:C.object,size:C.number}),ue(ge,"defaultProps",{onToggleControl:()=>{},onTriggerReload:()=>{},onDelete:()=>{},onSave:()=>{},dockStyle:{},size:550});const he=(0,le.rx)("MapCatalog",{component:(0,s.connect)((0,i.zB)({active:e=>e.controls&&e.controls.mapCatalog&&e.controls.mapCatalog.enabled,mapType:e=>(0,b.c0)(e)?(0,b.tH)(e):(0,b.$v)(e),user:f.np,triggerReloadValue:e=>{var t;return null===(t=e.mapcatalog)||void 0===t?void 0:t.triggerReloadValue},filterReloadDelay:e=>{var t;return null===(t=e.mapcatalog)||void 0===t?void 0:t.filterReloadDelay},dockStyle:e=>(0,de.ic)(e,{height:!0,right:!0},!0)}),{setFilterReloadDelay:g,onToggleControl:c.Xi.bind(null,"mapCatalog","enabled"),onTriggerReload:h,onDelete:e=>({type:p,resource:e}),onSave:e=>({type:d,resource:e})})(ge),containers:{BurgerMenu:{name:"mapCatalog",position:6,text:r().createElement(G.Z,{msgId:"mapCatalog.title"}),icon:r().createElement(n.Glyphicon,{glyph:"maps-catalog"}),tooltip:"mapCatalog.tooltip",action:()=>(0,c.Xi)("mapCatalog","enabled"),priority:2,doNotHide:!0},SidebarMenu:{name:"mapCatalog",position:6,icon:r().createElement(n.Glyphicon,{glyph:"maps-catalog"}),text:r().createElement(G.Z,{msgId:"mapCatalog.title"}),tooltip:"mapCatalog.tooltip",action:()=>(0,c.Xi)("mapCatalog","enabled"),toggle:!0,priority:1,doNotHide:!0}},reducers:{mapcatalog:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case m:return(0,re.t8)("filterReloadDelay",t.delay,e);case u:return(0,re.t8)("triggerReloadValue",!e.triggerReloadValue,e);default:return e}}},epics:o})},838169:(e,t,a)=>{var o=a(105976),l=a(497727),r=a(720893),n=a(846460),s=o((function(e,t,a){var o=1;if(a.length){var i=n(a,r(s));o|=32}return l(e,o,t,a,i)}));s.placeholder={},e.exports=s}}]);