(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[6235],{801387:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Support:()=>U,default:()=>K});var r=n(124852),o=n.n(r),s=n(171703),i=n(22222),a=n(612912),l=n(744448),c=n(727418),p=n.n(c);const u="SWIPE:SET_ACTIVE",m="SWIPE:SET_MODE",d="SWIPE:SET_SWIPE_TOOL_DIRECTION",g="SWIPE:SET_SPY_TOOL_RADIUS";function v(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"active";return{type:u,active:e,prop:t}}var y=n(49977),w=n.n(y),E=n(333101),S=n(275982);const h={resetLayerSwipeSettingsEpic:(e,t)=>e.ofType(E.c7).switchMap((e=>{let{nodeType:n}=e;const r=t.getState();return(0,l.yn)(r).active&&"group"===n?w().Observable.of(v(!1)):w().Observable.empty()})),deactivateSwipeToolOnSwitchMaps:(e,t)=>e.ofType(S.nk).switchMap((()=>(0,l.yn)(t.getState()).active?w().Observable.of(v(!1)):w().Observable.empty()))};var f=n(152543),b=n(743129),P=n(185552),M=n.n(P),I=n(313311),T=n.n(I),x=n(804504),C=n(688472);const z=[{label:"Horizontal",value:"cut-horizontal"},{label:"Vertical",value:"cut-vertical"}],R=e=>{let{spyModeSettings:t,onSetSpyToolRadius:n}=e;return o().createElement("div",{className:"mapstore-swipe-settings-spy"},o().createElement("h4",null,o().createElement(x.Z,{msgId:"toc.radius"})),o().createElement("div",{className:"mapstore-slider with-tooltip"},o().createElement(M(),{tooltips:!0,step:10,start:[t.radius],range:{min:[20],max:[100]},onChange:e=>n(e[0])})))},k=e=>{let{swipeModeSettings:t,onSetSwipeToolDirection:n}=e;return o().createElement("div",{className:"mapstore-swipe-settings-slider"},o().createElement("h4",null,o().createElement(x.Z,{msgId:"toc.direction"})),o().createElement(b.ZP,{styles:{menuPortal:e=>({...e,zIndex:3100})},onChange:e=>{let{value:t}=e;return n(t)},clearable:!1,value:T()(z,["value",t.direction]),options:z}))},L=(0,i.P1)([l.yn,l.wQ,l.IY],((e,t,n)=>({configuring:(null==e?void 0:e.configuring)||!1,toolMode:(null==e?void 0:e.mode)||"swipe",swipeModeSettings:t,spyModeSettings:n}))),N=(0,s.connect)(L,{onSetConfigurationActive:v,onSetSwipeToolDirection:function(e){return{type:d,direction:e}},onSetSpyToolRadius:function(e){return{type:g,radius:e}}})((e=>{let{configuring:t,toolMode:n,swipeModeSettings:r,spyModeSettings:s,onSetConfigurationActive:i=(()=>{}),onSetSpyToolRadius:a=(()=>{}),onSetSwipeToolDirection:l=(()=>{})}=e;return o().createElement("div",{className:"mapstore-swipe-settings"},o().createElement(C.Z,{title:"spy"===n?o().createElement(x.Z,{msgId:"toc.spyconfiguration"}):o().createElement(x.Z,{msgId:"toc.swipeconfiguration"}),open:t,onClose:()=>i(!1,"configuring"),enableFooter:!1,draggable:!0,size:"xs",bodyClassName:"mapstore-swipe-setiings-modal-body",dialogClassName:" mapstore-swipe-settings-modal",glyph:"transfer"},"spy"===n?o().createElement(R,{spyModeSettings:s,onSetSpyToolRadius:a}):o().createElement(k,{swipeModeSettings:r,onSetSwipeToolDirection:l})))}));var O=n(630294),A=n(485294),Z=n.n(A);const _=e=>{let{map:t,layer:n,type:o,getWidth:s,getHeight:i,circleCutProp:a}=e;const l=(0,r.useCallback)((e=>{let n=e.context;const r=s()*t.pixelRatio_;n.save(),n.beginPath(),n.rect(r,0,n.canvas.width-r,n.canvas.height),n.strokeStyle="rgba(0,0,0,0.5)",n.clip()}),[n,o]),c=(0,r.useCallback)((e=>{e.context.restore()}),[n,o]),p=(0,r.useCallback)((e=>{let n=e.context;const r=i()*t.pixelRatio_;n.save(),n.beginPath(),n.rect(0,r,n.canvas.width,n.canvas.height-r),n.clip()}),[n,o]),u=(0,r.useCallback)((e=>{let t=e.context,n=e.frameState.pixelRatio;t.save(),t.beginPath();const r=a.getMousePosition();r&&(t.arc(r[0]*n,r[1]*n,a.radius*n,0,2*Math.PI),t.lineWidth=5*n,t.strokeStyle="rgba(0,0,0,0.5)",t.stroke()),t.clip()}),[n,o,a]);return(0,r.useEffect)((()=>{const e=t.getLayers().getArray().filter((e=>e.get("msId")===n))[0];if(e){switch(o){case"cut-vertical":((e,t,n)=>{e.on("precompose",t),e.on("postcompose",n)})(e,l,c);break;case"cut-horizontal":((e,t,n)=>{e.on("precompose",t),e.on("postcompose",n)})(e,p,c);break;case"circle":((e,t,n)=>{e.on("precompose",t),e.on("postcompose",n)})(e,u,c)}return t.render(),()=>{e.un("precompose",l),e.un("precompose",p),e.un("precompose",u),e.un("postcompose",c),t.render()}}return()=>t.render()}),[n,o,a]),null},D=e=>{let{type:t,map:n,widthRef:s}=e;const[i,a]=(0,r.useState)(),[l,c]=(0,r.useState)(!0),p=()=>{a({x:0,y:0}),s.current=n.getProperties().size[0]/2};return(0,r.useEffect)((()=>(window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)})),[t]),(0,r.useEffect)((()=>{s.current=n.getProperties().size[0]/2}),[t]),o().createElement(Z(),{position:i,bounds:"parent",onStart:()=>c(!1),onDrag:(e,t)=>((e,t)=>{s.current+=t.deltaX,a({x:t.x,y:t.y}),n.render()})(0,t),onStop:()=>c(!0)},o().createElement("div",{className:"mapstore-swipe-slider",style:{height:"100%",top:"0px",left:n.getProperties().size[0]/2+"px",width:"8px",cursor:"col-resize"}},l&&o().createElement("div",{className:"ms-vertical-swipe-slider-arrows",style:{top:n.getProperties().size[1]/2-26+"px"}},o().createElement("div",{className:"ms-slider-arrows"},o().createElement(O.Glyphicon,{glyph:"chevron-left"})),o().createElement("div",{className:"ms-slider-arrows"},o().createElement(O.Glyphicon,{glyph:"chevron-right"})))))},G=e=>{let{type:t,map:n,heightRef:s}=e;const[i,a]=(0,r.useState)(),[l,c]=(0,r.useState)(!0),p=()=>{a({x:0,y:0}),s.current=n.getProperties().size[1]/2};return(0,r.useEffect)((()=>(window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)})),[t]),(0,r.useEffect)((()=>{s.current=n.getProperties().size[1]/2}),[t]),o().createElement(Z(),{position:i,bounds:"parent",onStart:()=>c(!1),onDrag:(e,t)=>((e,t)=>{s.current+=t.deltaY,a({x:t.x,y:t.y}),n.render()})(0,t),onStop:()=>c(!0)},o().createElement("div",{className:"mapstore-swipe-slider",style:{height:"8px",top:n.getProperties().size[1]/2+"px",left:"0px",width:"100%",cursor:"row-resize"}},l&&o().createElement("div",{className:"ms-horizontal-swipe-slider-arrows",style:{left:n.getProperties().size[0]/2-26+"px"}},o().createElement("div",{className:"ms-slider-arrows"},o().createElement(O.Glyphicon,{glyph:"chevron-up"})),o().createElement("div",{className:"ms-slider-arrows"},o().createElement(O.Glyphicon,{glyph:"chevron-down"})))))},Y=e=>{let{map:t,layer:n,type:s="cut-vertical",active:i}=e;const a=(0,r.useRef)(),l=(0,r.useRef)();return n&&i?o().createElement(o().Fragment,null,"cut-vertical"===s&&o().createElement(D,{widthRef:l,map:t,type:s}),"cut-horizontal"===s&&o().createElement(G,{heightRef:a,map:t,type:s}),o().createElement(_,{map:t,layer:n,type:s,getWidth:()=>l.current,getHeight:()=>a.current})):null},W=e=>{let{layer:t,map:n,active:s,radius:i}=e;const a=(0,r.useRef)(),l=(0,r.useCallback)((e=>{a.current=n.getEventPixel(e),n.render()}),[t,i]),c=(0,r.useCallback)((()=>{a.current=null,n.render()}),[t,i]);(0,r.useEffect)((()=>{const e=n.getTargetElement();return e.addEventListener("mousemove",l),e.addEventListener("mouseout",c),()=>{e.removeEventListener("mousemove",l),e.removeEventListener("mouseout",c)}}),[]);const p={radius:i,getMousePosition:()=>a.current};return t&&s?o().createElement(_,{map:n,layer:t,type:"circle",circleCutProp:p}):null};var j=n(45697),H=n.n(j);function Q(){return Q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Q.apply(this,arguments)}const F=(0,n(36549).Z)(O.SplitButton),V={title:o().createElement(O.Glyphicon,{glyph:"transfer"}),tooltipId:"toc.compareTool",tooltipPosition:"top",className:"square-button-md no-border",pullRight:!0},q=e=>{const{swipeSettings:t,onSetActive:n,onSetSwipeMode:r,status:s}=e;return o().createElement(F,Q({onClick:()=>{t.active||"LAYER"!==s?n(!1):n(!0)},bsStyle:null!=t&&t.active?"success":"primary"},V),o().createElement(O.MenuItem,{active:"swipe"===(null==t?void 0:t.mode),onClick:()=>{r("swipe"),n(!0)}},o().createElement(O.Glyphicon,{glyph:"vert-dashed"}),o().createElement(x.Z,{msgId:"toc.swipe"})),o().createElement(O.MenuItem,{active:"spy"===(null==t?void 0:t.mode),onClick:()=>{r("spy"),n(!0)}},o().createElement(O.Glyphicon,{glyph:"search"}),o().createElement(x.Z,{msgId:"toc.spyGlass"})),o().createElement(O.MenuItem,{onClick:()=>{t.configuring||"LAYER"!==s?n(!1,"configuring"):n(!0,"configuring")}},o().createElement(O.Glyphicon,{glyph:"cog"}),o().createElement(x.Z,{msgId:"toc.configureTool"})))};q.propTypes={swipeSettings:H().object,status:H().string,onSetActive:H().func,onSetSwipeMode:H().func},q.defaultProps={status:"LAYER",onSetSwipeMode:()=>{},onSetActive:()=>{}};const B=q,U=e=>{let{mode:t,map:n,layer:r,active:s,swipeModeSettings:i,spyModeSettings:a}=e;return"spy"===t?o().createElement(W,{map:n,layer:r,active:s,radius:a.radius}):o().createElement(Y,{map:n,layer:r,active:s,type:i.direction})},X=(0,i.P1)([a.Iz,l.yn,l.wQ,l.IY],((e,t,n,r)=>({layer:null==e?void 0:e.id,active:t.active||!1,swipeModeSettings:n,spyModeSettings:r,mode:(null==t?void 0:t.mode)||"swipe"}))),J=(0,s.connect)(X,null)(U),K=(0,f.rx)("Swipe",{options:{disablePluginIf:"{state('mapType') === 'leaflet' || state('mapType') === 'cesium'}"},component:N,containers:{TOC:{name:"Swipe",target:"toolbar",selector:e=>{let{status:t}=e;return"LAYER"===t},Component:(0,s.connect)((0,i.P1)(l.yn,(e=>({swipeSettings:e}))),{onSetActive:v,onSetSwipeMode:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"swipe";return{type:m,mode:e}}})(B)},Map:{name:"Swipe",Tool:J}},reducers:{swipe:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case u:return p()({},e,{[t.prop]:t.active});case m:return p()({},e,{mode:t.mode});case d:{const n={...e.swipe,direction:t.direction};return p()({},e,{swipe:n})}case g:{const n={...e.spy,radius:t.radius};return p()({},e,{spy:n})}default:return e}}},epics:h})},744448:(e,t,n)=>{"use strict";n.d(t,{yn:()=>r,IY:()=>o,wQ:()=>s});const r=e=>e.swipe&&e.swipe||{active:!1},o=e=>{var t;return(null==e||null===(t=e.swipe)||void 0===t?void 0:t.spy)||{radius:80}},s=e=>{var t;return(null==e||null===(t=e.swipe)||void 0===t?void 0:t.swipe)||{direction:"cut-vertical"}}}}]);