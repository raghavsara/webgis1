(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[7221],{100845:(e,t,o)=>{"use strict";o.d(t,{Z:()=>D});var n=o(124852),a=o.n(n),i=o(45697),r=o.n(i),s=o(630294),l=o(743129),p=o(36549),d=o(91175),u=o.n(d),h=o(807654),c=o.n(h),m=o(227361),g=o.n(m),v=o(441609),b=o.n(v),y=o(719648),f=o(8204),C=o(208335),E=o(804504),V=o(363082),P=o(495438),x=o(281763),F=o.n(x),S=o(556233),L=o(351546),w=o(481330),T=o(867076);const O=(e,t,o)=>F()(parseFloat(e))&&!isNaN(parseFloat(e))?(0,S.Ov)(parseFloat(e),t,o):e,j=(e,t,o)=>F()(parseFloat(e))&&!isNaN(parseFloat(e))?parseFloat((0,S.Ov)(e,o,t).toFixed(4)):e,k=(0,T.compose)((0,T.defaultProps)({valueUom:"m",displayUom:"m",units:[{value:"degrees",label:"deg",originUom:"degrees"},{value:"ft",label:"ft",originUom:"m"},{value:"m",label:"m",originUom:"m"},{value:"km",label:"km",originUom:"m"},{value:"mi",label:"mi",originUom:"m"},{value:"nm",label:"nm",originUom:"m"}]}),(0,T.withStateHandlers)((e=>{let{displayUom:t="nm"}=e;return{uom:t}}),{setUom:()=>e=>({uom:e})}),(0,T.withState)("localValue","setLocalValue"),(0,T.withPropsOnChange)(["value","localValue","uom","valueUom"],(e=>{let{value:t,localValue:o,uom:n,valueUom:a}=e;return{value:t===O(o,n,a)?o:j(t,n,a)}})),(0,T.withHandlers)({onChange:e=>{let{uom:t,projection:o,valueUom:n,onChange:a=(()=>{}),setLocalValue:i=(()=>{})}=e;return e=>{i(e),a(O(e,t,n),o)}}}))((e=>{let{value:t,units:o=[],uom:n,projection:i="EPSG:3857",style:r={display:"inline-flex",width:"100%"},setUom:l=(()=>{}),onChange:p=(()=>{})}=e;const d=(0,L.getUnits)(i);return a().createElement(s.FormGroup,{style:r},a().createElement(w.Z,{value:t,placeholder:"radius",name:"radius",onChange:e=>p(e,n),step:1,type:"number"}),a().createElement(s.FormControl,{componentClass:"select",placeholder:"select",value:n,onChange:e=>l(e.target.value),style:{width:85}},o.filter((e=>{let{originUom:t}=e;return d===t})).map((e=>a().createElement("option",{key:e.value,value:e.value},e.label)))))}));function M(){return M=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},M.apply(this,arguments)}function N(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const U=(0,p.Z)(s.Glyphicon),I=(0,p.Z)(s.DropdownButton);class Z extends a().Component{constructor(){var e;super(...arguments),e=this,N(this,"getValidationStateRadius",(e=>{const t=parseFloat(e);return c()(t)?"error":null})),N(this,"renderLabelTexts",((e,t)=>{const{textLabels:o,featurePropValue:n}=t;return"Polygon"===this.props.type?!b()(o)&&o[e].text:0!==e?b()(o)?!b()(n)&&n[0].formattedValue:o[e-1].text:null})),N(this,"validateCoordinates",(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props.components,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;if(t&&t.length){const a=t.filter(V.Tl);return o?a.length>e.props.componentsValidation[e.props.type].min||a.length>=e.props.componentsValidation[e.props.type].min&&!(0,V.Tl)(t[n]):a.length>=e.props.componentsValidation[e.props.type].min}return!1})),N(this,"validateCircle",(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props.components,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.props.properties.radius;if(t&&t.length){const e=u()(t);return!c()(parseFloat(o))&&(0,V.Tl)(e)}return!1})),N(this,"validateText",(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props.components,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.props.properties.valueText;if(t&&t.length){const e=u()(t);return!!o&&(0,V.Tl)(e)}return!1})),N(this,"isValid",(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.props.components,o=arguments.length>1?arguments[1]:void 0;return e[e.props.componentsValidation[e.props.type].validation](t,!1,o)})),N(this,"addCoordPolygon",(e=>{if("Polygon"===this.props.type){var t,o,n;const a=e.filter(V.Tl),i=(null===(t=this.props.features[this.props.currentFeature])||void 0===t||null===(o=t.geometry)||void 0===o||null===(n=o.coordinates)||void 0===n?void 0:n[0])||[],r=void 0!==i?i.findIndex((e=>!(0,V.Tl)({lon:e[0],lat:e[1]}))):-1;return e.concat([a.length&&0!==r?a[0]:{lat:"",lon:""}])}return e})),N(this,"change",((e,t)=>{let o=this.props.components;const n=c()(parseFloat(t.lat))?"":parseFloat(t.lat),a=c()(parseFloat(t.lon))?"":parseFloat(t.lon);o[e]={lat:n,lon:a};let i=this.addCoordPolygon(o);this.props.onChange(i,this.props.properties.radius,this.props.properties.valueText,this.props.mapProjection),this.isValid(o)?(this.props.isMouseEnterEnabled||"LineString"===this.props.type||"Polygon"===this.props.type)&&this.props.onHighlightPoint(o[e]):((this.props.isMouseLeaveEnabled||"LineString"===this.props.type||"Polygon"===this.props.type)&&this.props.onHighlightPoint(null),this.props.onSetInvalidSelected("coords",o.map(V.bh)))}))}renderCircle(){return a().createElement("div",{style:{flex:1,overflowY:"auto",padding:"0 10px"}},a().createElement("div",null,a().createElement(s.FormGroup,{validationState:this.getValidationStateRadius(this.props.properties.radius)},a().createElement(s.ControlLabel,null,a().createElement(E.Z,{msgId:"annotations.editor.radius"})),a().createElement(k,M({placeholder:"radius"},this.props.measureOptions,{value:this.props.properties.radius,projection:this.props.mapProjection,name:"radius",onChange:(e,t)=>{this.props.onValidateFeature(),this.isValid(this.props.components,e)?this.props.onChangeRadius(parseFloat(e),this.props.components.map(V.bh),t):""!==e?this.props.onChangeRadius(parseFloat(e),[],t):(this.props.onChangeRadius(null,this.props.components.map(V.bh),t),this.props.onSetInvalidSelected("radius",this.props.components.map(V.bh)))},step:1,type:"number"})))))}render(){const e=this.props.features[this.props.currentFeature||0],t=g()(e,"geometry.textLabels",[]),o=g()(e,"properties.values",[]),{componentsValidation:n,type:i}=this.props,r=[...this.props.components],p=r.filter(V.Tl).length===r.length,d=this[n[i].validation]()&&p,h=[{value:"decimal",text:a().createElement(E.Z,{msgId:"annotations.editor.decimal"})},{value:"aeronautical",text:a().createElement(E.Z,{msgId:"annotations.editor.aeronautical"})}],c=[{glyph:d?"ok-sign text-success":"exclamation-mark text-danger",tooltipId:d?"annotations.editor.valid":n[i].notValid,visible:!0},{Element:()=>a().createElement(I,{noCaret:!0,title:a().createElement(U,{glyph:"cog"}),pullRight:!0,className:"square-button-md no-border",tooltip:"Format"},h.map((e=>{let{text:t,value:o}=e;return a().createElement(s.MenuItem,{active:this.props.format===o,key:o,onClick:()=>this.props.onChangeFormat(o)},t)})))},{glyph:"plus",tooltipId:"annotations.editor.add",disabled:"Bearing"!==i&&this.props.properties.disabled,visible:!n[i].add||!n[i].max||this.props.components.length!==n[i].max,onClick:()=>{let e=[...this.props.components];e=e.concat([{lat:"",lon:""}]),this.props.onChange(e,this.props.properties.radius,this.props.properties.valueText,this.props.mapProjection)}}];return a().createElement("div",{className:"coordinates-editor",style:this.props.style},a().createElement("div",{className:"measure-feature-selector"},a().createElement("div",null,this.props.showFeatureSelector?a().createElement(l.ZP,{value:this.props.currentFeature,disabled:this.props.properties.disabled,options:[...this.props.features.map(((e,t)=>{const o=g()(e,"properties.values",[]),n="bearing"===(o[0]||{}).type?"Bearing":e.geometry.type;if(n!==this.props.type)return null;const a="LineString"===n?"Length":"Bearing"===n?"Bearing":"Area";return{label:`${n} (${o.length>0?`${a} ${o[0].formattedValue}`:""}${o.length>1&&"Polygon"===n?`, Perimeter: ${o[1].formattedValue}`:""})`,value:t}})),{label:(0,y.S$)(this.context.messages,"annotations.editor.newFeature"),value:this.props.features.length}].filter((e=>!!e)),onChange:e=>this.props.onChangeCurrentFeature(null==e?void 0:e.value)}):null),a().createElement("div",null,a().createElement(f.Z,{btnGroupProps:{className:"pull-right"},btnDefaultProps:{className:"square-button-md no-border"},buttons:c}))),"Circle"===this.props.type&&this.renderCircle(),"Circle"===this.props.type&&a().createElement("div",{style:{flex:1,overflowY:"auto",paddingLeft:10,marginTop:10}},a().createElement("div",null,a().createElement(s.ControlLabel,null,a().createElement(E.Z,{msgId:"annotations.editor.center"})))),a().createElement("div",{className:`coordinates-row-container coordinates-row-type-${i}`},this.props.components.map(((e,r)=>a().createElement(a().Fragment,null,this.props.showLengthAndBearingLabel&&a().createElement("div",{className:"label-texts"},a().createElement("span",null,this.renderLabelTexts(r,{textLabels:t,featurePropValue:o}))),a().createElement(P.Z,{format:this.props.format,aeronauticalOptions:this.props.aeronauticalOptions,sortId:r,key:r+" key",disabled:this.props.properties.disabled&&(0,V.Tl)(e),renderer:this.props.renderer,isDraggable:this.props.isDraggable,isDraggableEnabled:this.props.isDraggable&&this[n[i].validation]()&&!this.props.properties.disabled,showDraggable:this.props.isDraggable&&!("Point"===this.props.type||"Text"===this.props.type||"Circle"===this.props.type),formatVisible:!1,removeVisible:n[i].remove,removeEnabled:this[n[i].validation](this.props.components,n[i].remove,r),onSubmit:this.change,onMouseEnter:e=>{(this.props.isMouseEnterEnabled||"LineString"===this.props.type||"Polygon"===this.props.type||"MultiPoint"===this.props.type)&&this.props.onHighlightPoint(e)},onMouseLeave:()=>{(this.props.isMouseLeaveEnabled||"LineString"===this.props.type||"Polygon"===this.props.type||"MultiPoint"===this.props.type)&&this.props.onHighlightPoint(null)},onSort:(e,t)=>{const o=this.props.components.reduce(((o,n,a)=>e===a?e>t?[...o,{...n},u()(this.props.components.filter(((e,o)=>o===t)))]:[...o,u()(this.props.components.filter(((e,o)=>o===t))),{...n}]:t===a?[...o]:[...o,{...n}]),[]).filter((e=>e));this.isValid(o)?this.props.onChange(o):this.props.properties.isValidFeature&&this.props.onSetInvalidSelected("coords",this.props.components.map(V.bh))},idx:r,component:e,onRemove:()=>{const e=this.props.components.filter(((e,t)=>t!==r));this.isValid(e)?(this.props.isMouseEnterEnabled||"LineString"===this.props.type&&r!==e.length||"Polygon"===this.props.type?this.props.onHighlightPoint(e[r]):this.props.onHighlightPoint(null),this.props.onChange(e)):this.props.properties.isValidFeature&&this.props.onSetInvalidSelected("coords",this.props.components.map(V.bh))},onValidateFeature:this.props.onValidateFeature}))))),(!this.props.components||0===this.props.components.length)&&a().createElement("div",{className:"text-center",style:{padding:15,paddingBottom:30}},a().createElement("i",null,a().createElement(E.Z,{msgId:"annotations.editor.addByClick"}))))}}N(Z,"propTypes",{components:r().array,measureOptions:r().object,onSetInvalidSelected:r().func,onChange:r().func,onChangeRadius:r().func,onHighlightPoint:r().func,onChangeText:r().func,onChangeFormat:r().func,onChangeCurrentFeature:r().func,format:r().string,aeronauticalOptions:r().object,componentsValidation:r().object,transitionProps:r().object,properties:r().object,mapProjection:r().string,features:r().array,currentFeature:r().number,showFeatureSelector:r().bool,type:r().string,isDraggable:r().bool,isMouseEnterEnabled:r().bool,isMouseLeaveEnabled:r().bool,showLengthAndBearingLabel:r().bool,renderer:r().string,style:r().object,onValidateFeature:r().func}),N(Z,"contextTypes",{messages:r().object}),N(Z,"defaultProps",{components:[],measureOptions:{},onChange:()=>{},onChangeRadius:()=>{},onHighlightPoint:()=>{},onChangeFormat:()=>{},onChangeText:()=>{},onChangeCurrentFeature:()=>{},onSetInvalidSelected:()=>{},onValidateFeature:()=>{},componentsValidation:{Bearing:{min:2,max:2,add:!0,remove:!0,validation:"validateCoordinates",notValid:"annotations.editor.notValidPolyline"},Polygon:{min:3,add:!0,remove:!0,validation:"validateCoordinates",notValid:"annotations.editor.notValidPolyline"},LineString:{min:2,add:!0,remove:!0,validation:"validateCoordinates",notValid:"annotations.editor.notValidPolyline"},MultiPoint:{min:2,add:!0,remove:!0,validation:"validateCoordinates",notValid:"annotations.editor.notValidPolyline"},Point:{min:1,max:1,add:!0,remove:!1,validation:"validateCoordinates",notValid:"annotations.editor.notValidMarker"},Circle:{min:1,max:1,add:!0,remove:!1,validation:"validateCircle",notValid:"annotations.editor.notValidCircle"},Text:{min:1,max:1,add:!0,remove:!1,validation:"validateText",notValid:"annotations.editor.notValidText"}},transitionProps:{transitionName:"switch-panel-transition",transitionEnterTimeout:300,transitionLeaveTimeout:300},features:[],isDraggable:!0,isMouseEnterEnabled:!1,isMouseLeaveEnabled:!1,properties:{},type:"Point",style:{display:"flex",flexDirection:"column",flex:1}});const D=(0,C.Z)(Z)},502422:(e,t,o)=>{"use strict";o.d(t,{U:()=>u});var n=o(687753),a=o(49977),i=o.n(a),r=o(119008),s=o(172768),l=o(296252),p=o(859518),d=o(306692);const u=function(e,t,o){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(e,t)=>i().Observable.from([(0,n.Xg)(t,"enabled",null)]),u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(e,t)=>(0,r.Yq)(t)(e);return e.ofType(s.Np,l.hZ,p.YD,d.$O).filter((e=>{let{type:n,status:a,owner:i,eventName:r,toolName:h}=e;const c=u(t.getState(),o);switch(n){case d.$O:return"featureGrid"!==o;case p.YD:return c&&"click"===r&&h!==o;case l.hZ:return c&&("drawOrEdit"===a||"start"===a)&&i!==o;case s.Np:default:return c&&"annotations"!==o}})).switchMap((e=>u(t.getState(),o)?a(t.getState(),o,e):i().Observable.empty()))}}}]);