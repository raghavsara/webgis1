(self.webpackChunkmapstore2=self.webpackChunkmapstore2||[]).push([[5398],{806783:(e,t,r)=>{"use strict";r.d(t,{F:()=>s});var i=r(470509),o=r.n(i),n=r(351546),a=r(835516);const s=e=>o().get(e).then((e=>{let{data:t}=e;return(i=t,Promise.all([r.e(8343),r.e(1250)]).then(r.bind(r,624089)).then((e=>{var t,r,o;const s=e,l=void 0!==(null==i||null===(t=i.asset)||void 0===t?void 0:t.version)?i.asset.version:"1.0",c=function(e,t){var r,i,o,s,l,c;if(null!=t&&null!==(r=t.root)&&void 0!==r&&null!==(i=r.boundingVolume)&&void 0!==i&&i.region){const[e,r,i,o]=t.root.boundingVolume.region;return{bounds:{minx:(0,n.convertRadianToDegrees)(e),miny:(0,n.convertRadianToDegrees)(r),maxx:(0,n.convertRadianToDegrees)(i),maxy:(0,n.convertRadianToDegrees)(o)},crs:"EPSG:4326"}}const p=e.Matrix4.fromArray(t.root.transform||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(null!=t&&null!==(o=t.root)&&void 0!==o&&null!==(s=o.boundingVolume)&&void 0!==s&&s.box){const[r,i,o]=t.root.boundingVolume.box,s=e.Matrix4.multiplyByPoint(p,new e.Cartesian3(r,i,o),new e.Cartesian3),l=e.Matrix4.getMatrix3(p,new e.Matrix4),c=e.Matrix3.multiply(l,e.Matrix3.fromArray(t.root.boundingVolume.box,3,new e.Matrix3),new e.Matrix3),u=e.BoundingSphere.fromOrientedBoundingBox(new e.OrientedBoundingBox(s,c)),d=e.Cartographic.fromCartesian(u.center);if(!d)return null;const m=(0,n.convertRadianToDegrees)(d.longitude),f=(0,n.convertRadianToDegrees)(d.latitude),g=u.radius/a.METERS_PER_UNIT.degrees;return{bounds:{minx:m-g,miny:f-g,maxx:m+g,maxy:f+g},crs:"EPSG:4326"}}if(null!=t&&null!==(l=t.root)&&void 0!==l&&null!==(c=l.boundingVolume)&&void 0!==c&&c.sphere){const[r,i,o,s]=t.root.boundingVolume.sphere,l=e.Matrix4.multiplyByPoint(p,new e.Cartesian3(r,i,o),new e.Cartesian3),c=e.Matrix4.getScale(p,new e.Matrix4),u=s*e.Cartesian3.maximumComponent(c)/a.METERS_PER_UNIT.degrees,d=e.Cartographic.fromCartesian(l);if(!d)return null;const m=(0,n.convertRadianToDegrees)(d.longitude),f=(0,n.convertRadianToDegrees)(d.latitude);return{bounds:{minx:m-u,miny:f-u,maxx:m+u,maxy:f+u},crs:"EPSG:4326"}}return null}(s,i);return{version:l,...c&&{bbox:c},format:function(e){const t=e.split(/\./g);return t[t.length-1]}((null==i||null===(r=i.root)||void 0===r||null===(o=r.content)||void 0===o?void 0:o.uri)||""),properties:null==i?void 0:i.properties}}))).then((e=>({tileset:t,...e})));var i}))},964091:(e,t,r)=>{"use strict";r.d(t,{Z:()=>mt});var i={};r.r(i),r.d(i,{getCatalogRecords:()=>X,getLayerFromRecord:()=>H,preprocess:()=>_,testService:()=>z,textSearch:()=>J,validate:()=>Z});var o={};r.r(o),r.d(o,{getCatalogRecords:()=>ne,getLayerFromRecord:()=>ae,preprocess:()=>te,testService:()=>ie,textSearch:()=>oe,validate:()=>re});var n={};r.r(n),r.d(n,{getCatalogRecords:()=>ye,getLayerFromRecord:()=>xe,preprocess:()=>ge,testService:()=>be,textSearch:()=>fe,validate:()=>ve});var a={};r.r(a),r.d(a,{getCatalogRecords:()=>$e,getLayerFromRecord:()=>Ne,getRecords:()=>Ae,testService:()=>Ie,textSearch:()=>Ge,tileProviderToLayer:()=>Ve,tmsToLayer:()=>ke,validate:()=>De});var s={};r.r(s),r.d(s,{getCatalogRecords:()=>Ke,getLayerFromRecord:()=>Ye,getRecords:()=>Ze,preprocess:()=>ze,testService:()=>Xe,textSearch:()=>He,validate:()=>Je});var l={};r.r(l),r.d(l,{getCatalogRecords:()=>it,getLayerFromRecord:()=>ot,preprocess:()=>et,testService:()=>rt,textSearch:()=>Qe,validate:()=>tt});var c={};r.r(c),r.d(c,{getCatalogRecords:()=>pt,getLayerFromRecord:()=>ut,preprocess:()=>st,testService:()=>lt,textSearch:()=>ct,validate:()=>dt});var p=r(91175),u=r.n(p),d=r(747037),m=r.n(d),f=r(264721),g=r.n(f),v=r(984596),b=r.n(v),y=r(189734),x=r.n(y),h=r(944908),S=r.n(h),w=r(701469),O=r.n(w),R=r(763105),T=r.n(R),M=r(441609),C=r.n(M),L=r(414293),F=r.n(L),U=r(727418),P=r.n(U),E=r(835516),W=r(49977),B=r.n(W),A=r(234228),G=r(399790),D=r(175063),I=r(467763),$=r(470509),k=r.n($);class V extends Error{constructor(e,t){super(e),this.name="ServiceValidationError",this.notification=t}}const N=e=>B().Observable.of(e),j=e=>""===e.title||""===e.url?B().Observable.throw(new V("Validation Error","catalog.notification.warningAddCatalogService")):B().Observable.of(e),q=e=>{let{parseUrl:t=(e=>e)}=e;return e=>{const r="catalog.notification.errorServiceUrl";return B().Observable.defer((()=>k().get(t(e.url)))).catch((()=>{throw new V("Service Test error",r)})).switchMap((t=>{if(t.error||""===t.data)throw new V("Service Test error",r);return B().Observable.of(e)}))}},_=e=>{let{domainAliases:t}=e;return e.domainAliases=T()(t),W.Observable.of(e)},Z=j,z=q({parseUrl:I.en}),J=I.tt,X=(e,t)=>e&&e.records?e.records.map((r=>{const i=[{type:"OGC:WMS",url:t&&t.url,SRS:r.SRS&&(O()(r.SRS)?r.SRS:[r.SRS])||[],params:{name:r.Name}}],{wms:o}=(0,D.tW)({references:i});return{serviceType:"wms",isValid:!!o,capabilities:r,credits:r.credits,boundingBox:(0,I.jY)(r),description:r.Abstract||r.Title||r.Name,identifier:r.Name,service:e.service,tags:"",layerOptions:{...(null==t?void 0:t.layerOptions)||{},...(null==e?void 0:e.layerOptions)||{}},title:(0,G.EM)(r)||r.Name,formats:b()(r.formats||[]),dimensions:(r.Dimension&&b()(r.Dimension)||[]).map((e=>P()({},{values:e._&&e._.split(",")||[]},e.$||{}))).filter((e=>e&&"time"!==e.name)),references:i,ogcReferences:o}})):null,H=(e,t,r)=>{const i=function(e){let{removeParams:t=[],format:r,catalogURL:i,url:o,formats:n={},map:a={},layerBaseConfig:s,localizedLayerStyles:l,allowUnsecureLayers:c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||!e.references)return null;const{wms:p}=(0,D.tW)(e),u=e=>(0,D.em)((0,A.$F)(e),["request","layer","layers","service","version"].concat(t));let d,m;const f=(0,D.qy)(p.url);if(f&&O()(f))d=f.map((e=>u(e))).map((e=>{let{url:t}=e;return t})),m=f.map((e=>u(e))).map((e=>{let{params:t}=e;return t})).reduce(((e,t)=>({...e,...t})),{});else{const{url:e,params:t}=u(f||i);d=e,m=t}const g=(x=o||d,O()(x)&&1===x.length?x[0]:x),v=(0,D.n0)(p.SRS),{MaxScaleDenominator:b,MinScaleDenominator:y}=(null==e?void 0:e.capabilities)??{};var x;let h={type:"wms",requestEncoding:e.requestEncoding,style:e.style,format:r,url:g,capabilitiesURL:e.capabilitiesURL,queryable:e.queryable,visibility:!0,dimensions:e.dimensions||[],name:p.params&&p.params.name,title:e.title||p.params&&p.params.name,description:e.description||"",credits:!(0,A.u8)("noCreditsFromCatalog")&&e.credits,bbox:{crs:e.boundingBox.crs,bounds:{minx:e.boundingBox.extent[0],miny:e.boundingBox.extent[1],maxx:e.boundingBox.extent[2],maxy:e.boundingBox.extent[3]}},links:(0,D.F8)(e),params:m,allowedSRS:v,catalogURL:i,...s,...e.layerOptions,localizedLayerStyles:F()(l)?void 0:l,...!C()(n)&&{imageFormats:n.imageFormats,infoFormats:n.infoFormats},...!F()(c)&&{forceProxy:c}};if(!C()(a)&&(b||y)){const{resolution:e}=!F()(y)&&(0,E.getResolutionObject)(y,"scale",a)||{},{resolution:t}=!F()(b)&&(0,E.getResolutionObject)(b,"scale",a)||{};h={...h,minResolution:e,maxResolution:t}}return h}(e,t);return r?Promise.resolve(i):i};var K=r(719648),Y=r(742178);const Q=(e,t,r)=>{let i=r.name;if(void 0===i){i=e.title?e.title.join(" "):(0,K.S$)(t,"catalog.notAvailable");const a=(o=r.protocol,r.value,(null===(n=u()([{protocol:"https://registry.geodati.gov.it/metadata-codelist/ProtocolValue/www-download",displayValue:"Download"},{protocol:"http://www.opengis.net/def/serviceType/ogc/wms",displayValue:"WMS"},{protocol:"http://www.opengis.net/def/serviceType/ogc/wfs",displayValue:"WFS"}].filter((e=>e.protocol===o))))||void 0===n?void 0:n.displayValue)??"Link");i=`${a?`${i} - ${a}`:i}`}var o,n;return`<li><a target="_blank" href="${r.value}">${i}</a></li>`};function ee(e,t){const r=(null==e?void 0:e.URI)&&b()(e.URI);let i;if(r){const e=u()(r.filter((e=>"thumbnail"===e.name)))||u()(r.filter((e=>{var t;return!e.name&&(null===(t=e.protocol)||void 0===t?void 0:t.indexOf("image/"))>-1})));i=e?e.value:null}if(!i&&e&&e.references){const t=(e=>u()(b()(e.references).filter((t=>"WWW:LINK-1.0-http--image-thumbnail"===t.scheme||"thumbnail"===t.scheme||"WWW:DOWNLOAD-1.0-http--download"===t.scheme&&-1!==(t.value||"").indexOf(`${e.identifier||""}-thumb`)||"WWW:DOWNLOAD-REST_MAP"===t.scheme&&-1!==(t.value||"").indexOf(`${e.identifier||""}-thumb`)))))(e);t&&(i=t.value)}var o;return i&&(0===i.indexOf("http")||(i=((o=t&&t.url)&&o.replace(/\/csw$/,"/")||"")+i)),i}const te=N,re=j,ie=q({parseUrl:Y.ZP.parseUrl}),oe=Y.ZP.textSearch,ne=(e,t,r)=>{let i=e;return i&&i.records?i.records.map((e=>{const i=e.dc;let o=[];i&&i.references&&(Array.isArray(i.references)?i.references:[i.references]).filter((e=>e.scheme.indexOf("http-get-capabilities")>-1)).forEach((e=>{let r=0===e.value.indexOf("http")?e.value:(t&&t.catalogURL||"")+"/"+e.value;o.push({type:e.scheme,url:r})}));const n=(0,Y.kv)(i,t);n&&o.push(n);let a={boundingBox:e.boundingBox&&e.boundingBox.extent&&b()(e.boundingBox.extent.join(","))};if(i&&(a={...a,...x()(Object.keys(i)).reduce(((e,t)=>({...e,[t]:S()(b()(i[t]))})),{})}),i&&i.URI&&b()(i.URI)&&b()(i.URI).length&&(a={...a,uri:["<ul>"+b()(i.URI).map(Q.bind(void 0,a,r)).join("")+"</ul>"]}),i&&i.subject&&b()(i.subject)&&b()(i.subject).length&&(a={...a,subject:["<ul>"+b()(i.subject).map((e=>`<li>${e}</li>`)).join("")+"</ul>"]}),o&&b()(o).length?a={...a,references:["<ul>"+b()(o).map((e=>`<li><a target="_blank" href="${e.url}">${e.params&&e.params.name||e.url}</a></li>`)).join("")+"</ul>"]}:delete a.references,i&&i.temporal){let e=m()(i.temporal)?i.temporal.split("; "):[];if(e.length){let t=e.filter((e=>-1!==e.indexOf("scheme="))).map((e=>{const t=e.indexOf("=");return e.substr(t+1,e.length-1)}));t=t.length?t[0]:"W3C-DTF";let i=e.filter((e=>-1!==e.indexOf("start=")||-1!==e.indexOf("end="))).map((e=>{const i=e.indexOf("="),o=e.substr(0,i),n=e.substr(i+1,e.length-1),a=e.length-i-1<=10;return g()(["start","end"],o)&&"W3C-DTF"===t&&!a?(0,K.S$)(r,`catalog.${o}`)+new Date(n).toLocaleString():g()(["start","end"],o)?(0,K.S$)(r,`catalog.${o}`)+n:""}));a={...a,temporal:["<ul>"+i.map((e=>`<li>${e}</li>`)).join("")+"</ul>"]}}}const s={...(0,D.tW)({references:o}),...(0,D.FJ)({references:o})},l=Object.keys(s).find((e=>s[e])),c=l&&"esri"!==l?s[l]:void 0;return{serviceType:"csw",layerType:l,isValid:!!l,boundingBox:e.boundingBox,description:i&&m()(i.abstract)&&i.abstract||"",layerOptions:t&&t.layerOptions||{},identifier:i&&m()(i.identifier)&&i.identifier||"",references:o,thumbnail:ee(i,t),title:i&&m()(i.title)&&i.title||"",tags:i&&i.tags||"",metadata:a,capabilities:e.capabilities,ogcReferences:c}})):null},ae=(e,t,r)=>{const i=((e,t)=>{switch(e.layerType){case"wms":return H(e,t);case"esri":return function(e){let{layerBaseConfig:t={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||!e.references)return null;const{esri:r}=(0,D.FJ)(e);return{type:r.type,url:r.url,visibility:!0,dimensions:e.dimensions||[],name:r.params&&r.params.name,bbox:{crs:e.boundingBox.crs,bounds:{minx:e.boundingBox.extent[0],miny:e.boundingBox.extent[1],maxx:e.boundingBox.extent[2],maxy:e.boundingBox.extent[3]}},...t}}(e,t);default:return null}})(e,t);return r?Promise.resolve(i):i};var se=r(513218),le=r.n(se),ce=r(351546),pe=r(276570),ue=r(797678);const de=e=>le()(e)&&e._||e,me=(e,t)=>e.filter((r=>(0,pe.C2)(t,r,e,t,null))),fe=ue.Z.textSearch,ge=N,ve=j,be=q({parseUrl:ue.Z.parseUrl}),ye=(e,t)=>e&&e.records?e.records.map((e=>{let r=b()((0,pe.f1)(e)||t&&t.url);1===r.length&&(r=r[0]);const i=(0,pe.dN)(e),o=b()(e.TileMatrixSetLink||[]).reduce(((t,r)=>{const i=u()((e.TileMatrixSet&&b()(e.TileMatrixSet)||[]).filter((e=>e["ows:Identifier"]===r.TileMatrixSet))),o=i&&(0,ce.getEPSGCode)(i["ows:SupportedCRS"]),n=r.TileMatrixSetLimits&&(r.TileMatrixSetLimits.TileMatrixLimits||[]).map((e=>({identifier:e.TileMatrix,ranges:{cols:{min:e.MinTileCol,max:e.MaxTileCol},rows:{min:e.MinTileRow,max:e.MaxTileRow}}})))||i.TileMatrix.map((e=>({identifier:e["ows:Identifier"]})));return P()(t,{[i["ows:Identifier"]]:n,[o]:n})}),{}),n=(e=>{let t=e["ows:WGS84BoundingBox"];return t||(t={"ows:LowerCorner":"-180.0 -90.0","ows:UpperCorner":"180.0 90.0"}),t})(e),a=[{type:"OGC:WMTS",url:r,SRS:me(e.SRS||[],o),params:{name:e["ows:Identifier"]}}],{wmts:s}=(0,D.tW)({references:a});return{serviceType:"wmts",isValid:!!s,title:de(e["ows:Title"]||e["ows:Identifier"]),description:de(e["ows:Abstract"]||e["ows:Title"]||e["ows:Identifier"]),identifier:de(e["ows:Identifier"]),tags:"",layerOptions:t&&t.layerOptions||{},style:e.style,capabilitiesURL:i,queryable:e.queryable,requestEncoding:e.requestEncoding,tileMatrixSet:e.TileMatrixSet,matrixIds:o,format:e.format,TileMatrixSetLink:b()(e.TileMatrixSetLink),boundingBox:{extent:[n["ows:LowerCorner"].split(" ")[0],n["ows:LowerCorner"].split(" ")[1],n["ows:UpperCorner"].split(" ")[0],n["ows:UpperCorner"].split(" ")[1]],crs:"EPSG:4326"},references:a,ogcReferences:s}})):null,xe=(e,t,r)=>{const i=function(e){let{removeParams:t=[],format:r,catalogURL:i,url:o,layerBaseConfig:n,localizedLayerStyles:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||!e.references)return null;const{wmts:s}=(0,D.tW)(e),l=e=>(0,D.em)((0,A.$F)(e),["request","layer","layers","service","version"].concat(t));let c,p;const u=(0,D.qy)(s.url);if(u&&O()(u))c=u.map((e=>l(e))).map((e=>{let{url:t}=e;return t})),p=u.map((e=>l(e))).map((e=>{let{params:t}=e;return t})).reduce(((e,t)=>({...e,...t})),{});else{const{url:e,params:t}=l(u||i);c=e,p=t}const d=(f=o||c,O()(f)&&1===f.length?f[0]:f),m=(0,D.n0)(s.SRS);var f;return{type:"wmts",requestEncoding:e.requestEncoding,style:e.style,format:r,url:d,capabilitiesURL:e.capabilitiesURL,queryable:e.queryable,visibility:!0,dimensions:e.dimensions||[],name:s.params&&s.params.name,title:e.title||s.params&&s.params.name,matrixIds:e.matrixIds||[],description:e.description||"",tileMatrixSet:e.tileMatrixSet||[],credits:!(0,A.u8)("noCreditsFromCatalog")&&e.credits,bbox:{crs:e.boundingBox.crs,bounds:{minx:e.boundingBox.extent[0],miny:e.boundingBox.extent[1],maxx:e.boundingBox.extent[2],maxy:e.boundingBox.extent[3]}},links:(0,D.F8)(e),params:p,allowedSRS:m,catalogURL:i,...n,...e.layerOptions,localizedLayerStyles:F()(a)?void 0:a}}(e,t);return r?Promise.resolve(i):i};var he=r(227361),Se=r.n(he),we=r(505055),Oe=r.n(we),Re=r(555363),Te=r(531987);const Me={},Ce=(e,t)=>e===t||"EPSG:3857"===e&&"EPSG:900913"===t||"EPSG:900913"===e&&"EPSG:3857"===t,Le=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const n=b()(Se()(e,"TileMapService.TileMaps.TileMap",[])),{projection:a}=o,s=Se()(o,"options.service.allSRS"),l=n.map((t=>{let{$:r={}}=t;return{...r,href:(0,Re.cleanAuthParamsFromURL)(r.href),identifier:(0,Re.cleanAuthParamsFromURL)(r.href),format:(0,Te.A)(r.href),tmsUrl:(0,Re.cleanAuthParamsFromURL)(e.url)}})).filter((e=>{let{srs:t}=e;return!(a&&!s)||Ce(t,a)})).filter((function(){let{title:e="",srs:t=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!i||-1!==e.toLowerCase().indexOf(i.toLowerCase())||-1!==t.toLowerCase().indexOf(i.toLowerCase())}));return{numberOfRecordsMatched:l.length,numberOfRecordsReturned:Math.min(r,l.length),nextRecord:t+Math.min(r,l.length)+1,records:l.filter(((e,i)=>i>=t-1&&i<t-1+r))}},Fe=e=>e,Ue=(e,t,r,i,o)=>{const n=Me[e];return n&&(new Date).getTime()<n.timestamp+1e3*(A.ZP.getConfigProp("cacheExpire")||60)?new Promise((e=>{e(Le(n.data,t,r,i,o))})):k().get(e).then((n=>{let a;return Oe().parseString(n.data,{explicitArray:!1},((t,r)=>{a={...r,url:e}})),Me[e]={timestamp:(new Date).getTime(),data:a},Le(a,t,r,i,o)}))};var Pe=r(836727),Ee=r(959956);const We="custom",Be=(e,t,r,i,o)=>{const n=Se()(o,"options.service");let a=[];if(n.provider&&n.provider!==We){const e=(s=n.provider,Object.keys((null===Pe.Z||void 0===Pe.Z||null===(l=Pe.Z[s])||void 0===l?void 0:l.variants)??{}));0===e.length?a.push({provider:`${n.provider}`,title:`${n.provider}`}):a=e.map((e=>({provider:`${n.provider}.${e}`})))}else n.url&&(a=[{...n,title:n.title,type:"tileprovider",url:n.url,attribution:n.attribution,options:n.options||{},provider:We}]);var s,l;return new Promise((e=>{e(((e,t,r,i)=>{const o=e.filter((function(){let{title:e=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!i||-1!==e.toLowerCase().indexOf(i.toLowerCase())})),n=o.filter(((e,i)=>i>=t-1&&i<t-1+r));return{numberOfRecordsMatched:o.length,numberOfRecordsReturned:n.length,nextRecord:t+Math.min(r,o.length)+1,records:n}})(a,t,r,i))}))},Ae=function(e,t,r,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{options:n}=o,{service:a={}}=n||{};return"tms"===a.provider&&Ue(e,t,r,i,o),Be(0,t,r,i,o)},Ge=function(e,t,r,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{options:n}=o,{service:a={}}=n||{};return"tms"===a.provider?Ue(e,t,r,i,o):Be(0,t,r,i,o)},De=e=>"tms"===e.provider?j(e):(e=>{const t=e.provider&&"custom"!==e.provider?!!e.provider:(r=e.url,(0,Ee.Nw)(r));var r;if(e.title&&t)return W.Observable.of(e);throw new Error("catalog.config.notValidURLTemplate")})(e),Ie=e=>"tms"===e.provider?q({parseUrl:Fe})(e):(e=>W.Observable.of(e))(e),$e=(e,t)=>{if(e&&e.records){if(t.service&&"tms"===t.service.provider){const r=[{type:"OGC:TMS",version:"1.0.0",url:t.url}],{tms:i}=(0,D.tW)({references:r});return e.records.map((e=>({serviceType:"tms",layerType:"tms",isValid:!!i,title:e.title,tileMapUrl:e.href,description:`${e.srs}${e.format?", "+e.format:""}`,tmsUrl:t.tmsUrl,references:r,ogcReferences:i})))}return e.records.map((e=>({serviceType:"tms",layerType:"tileprovider",isValid:!!e.provider,title:e.title||e.provider,url:e.url,attribution:e.attribution,options:e.options,provider:e.provider,references:[]})))}return null},ke=(e,t)=>{let{tileMapUrl:r}=e,{tileMap:i,service:o}=t;const{TileMap:n={}}=i||{},{forceDefaultTileGrid:a}=o||{},{Title:s,Abstract:l,SRS:c,BoundingBox:p={},Origin:u,TileFormat:d={},TileSets:m}=n,{version:f,tilemapservice:g}=n.$,{minx:v,miny:y,maxx:x,maxy:h}=Se()(p,"$",{}),{x:S,y:w}=Se()(u,"$"),{width:O,height:R,"mime-type":T,extension:M}=Se()(d,"$",{}),C=[parseFloat(O),parseFloat(R,10)],L=b()(Se()(m,"TileSet",[]).map((e=>{let{$:t}=e;return t}))).map((e=>{let{href:t,order:r,"units-per-pixel":i}=e;return{href:(0,Re.cleanAuthParamsFromURL)(t),order:parseFloat(r),resolution:parseFloat(i)}})),F=Se()(m,"profile");return{title:s,visibility:!0,hideErrors:!0,name:s,allowedSRS:{[c]:!0},description:l,srs:c,version:f,tileMapService:g?(0,Re.cleanAuthParamsFromURL)(g):void 0,type:"tms",profile:F,tileMapUrl:r,forceDefaultTileGrid:a,bbox:p&&{crs:c,bounds:{minx:parseFloat(v),miny:parseFloat(y),maxx:parseFloat(x),maxy:parseFloat(h)}},tileSets:L,origin:{x:parseFloat(S),y:parseFloat(w)},format:T,tileSize:C,extension:M}},Ve=e=>({type:"tileprovider",visibility:!0,url:e.url,title:e.title,attribution:e.attribution,options:e.options,provider:e.provider,name:e.provider}),Ne=(e,t,r)=>{return r?"tms"===e.layerType?(i=e.tileMapUrl,k().get(i).then((e=>new Promise((t=>{Oe().parseString(e.data,{explicitArray:!1},((e,r)=>t(r)))}))))).then((r=>ke(e,{...t,tileMap:r}))):Promise.resolve(Ve(e)):((e,t)=>"tms"===e.layerType?ke(e,t):"tileprovider"===e.layerType?Ve(e,t):null)(e,t);var i};var je=r(487758);const qe={},_e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;const o=b()(Se()(e,'["wfs:WFS_Capabilities"].FeatureTypeList.FeatureType',[])),n=o.map((t=>{const{Name:r,Title:i,Abstract:o,DefaultSRS:n,OtherSRS:a=[]}=t,s=t["ows:WGS84BoundingBox"],l=s["ows:LowerCorner"].split(" "),c=s["ows:UpperCorner"].split(" "),p={minx:parseFloat(l[0]),miny:parseFloat(l[1]),maxx:parseFloat(c[0]),maxy:parseFloat(c[1])};return{featureType:t,type:"wfs",url:(0,Re.cleanAuthParamsFromURL)(e.url),name:r,title:i,description:o,SRS:[n,...a],defaultSRS:n,boundingBox:{bounds:p,crs:"EPSG:4326"}}})).filter((function(){let{title:e="",name:t="",description:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!i||-1!==e.toLowerCase().indexOf(i.toLowerCase())||-1!==t.toLowerCase().indexOf(i.toLowerCase())||-1!==r.toLowerCase().indexOf(i.toLowerCase())})),a=n.filter(((e,i)=>i>=t-1&&i<t-1+r));return{numberOfRecordsMatched:n.length,numberOfRecordsReturned:Math.min(r,a.length),nextRecord:t+Math.min(r,n.length)+1,records:a}},Ze=(e,t,r,i,o)=>{const n=qe[e];return n&&(new Date).getTime()<n.timestamp+1e3*(A.ZP.getConfigProp("cacheExpire")||60)?new Promise((e=>{e(_e(n.data,t,r,i,o))})):(0,je.FU)(e).then((n=>{let a;return Oe().parseString(n.data,{explicitArray:!1,stripPrefix:!0},((t,r)=>{a={...r,url:e}})),qe[e]={timestamp:(new Date).getTime(),data:a},_e(a,t,r,i,o)}))},ze=N,Je=j,Xe=q({parseUrl:je.dN}),He=(e,t,r,i,o)=>Ze(e,t,r,i,o),Ke=function(){let{records:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e?e.map((e=>{const t=[{type:"OGC:WFS-1.1.0-http-get-capabilities",url:e.url},{type:"OGC:WFS-1.1.0-http-get-feature",url:e.url}],{wfs:r}=(0,D.tW)({references:t});return{...e,serviceType:"wfs",isValid:!!r,references:t,ogcReferences:r}})):null},Ye=(e,t,r)=>{const i=(e=>({type:e.type||"wfs",search:{url:e.url,type:"wfs"},url:e.url,queryable:e.queryable,visibility:!0,name:e.name,title:e.title||e.name,description:e.description||"",bbox:e.boundingBox,links:(0,D.F8)(e),style:{weight:1,color:"rgba(0, 0, 255, 1)",opacity:1,fillColor:"rgba(0, 0, 255, 0.1)",fillOpacity:.1,radius:10},...e.layerOptions}))(e);return r?Promise.resolve(i):i};const Qe=r(477862).Z.textSearch,et=N,tt=j,rt=q({parseUrl:e=>e}),it=e=>e&&e.records?e.records.map((e=>({serviceType:"backgrounds",isValid:!!e,description:e.title,title:e.title,identifier:e.name,thumbnail:e.thumbURL,references:[],background:e}))):null,ot=(e,t,r)=>{const i=(e=>({...null==e?void 0:e.background,id:null==e?void 0:e.background.name,visibility:!1}))(e);return r?Promise.resolve(i):i};var nt=r(806783);function at(e){const t=e.split("/");return t[t.length-2]}const st=N,lt=e=>W.Observable.of(e),ct=(e,t,r,i,o)=>((e,t,r,i,o)=>(0,nt.F)(e).then((t=>{var r,n;let{tileset:a,...s}=t;const l=[{title:(null==o||null===(r=o.options)||void 0===r||null===(n=r.service)||void 0===n?void 0:n.title)||at(e),url:e,type:"3dtiles",tileset:a,...s}].filter((e=>{let{title:t}=e;return!i||(null==t?void 0:t.toLowerCase().includes((null==i?void 0:i.toLowerCase())||""))}));return{numberOfRecordsMatched:l.length,numberOfRecordsReturned:l.length,records:l}})))(e,0,0,i,o),pt=e=>null!=e&&e.records?e.records.map((e=>{const{version:t,bbox:r,format:i,properties:o}=e;return{serviceType:"3dtiles",isValid:!0,description:`v. ${t}`,title:e.title,identifier:e.url,url:e.url,thumbnail:null,...r&&{bbox:r},...i&&{format:i},...o&&{properties:o},references:[]}})):null,ut=(e,t,r)=>{const i=(e=>{const{bbox:t,format:r,properties:i}=e;return{type:"3dtiles",url:e.url,title:e.title,visibility:!0,...t&&{bbox:t},...r&&{format:r},...i&&{properties:i}}})(e);return r?Promise.resolve(i):i},dt=e=>{if(e.title&&function(e){if((0,Ee.Nw)(e)){const t=e.split(/\./g);return"json"===t[t.length-1]}return!1}(e.url))return W.Observable.of(e);throw new Error("catalog.config.notValidURLTemplate")},mt={csw:o,wfs:s,wms:i,tms:a,wmts:n,backgrounds:l,"3dtiles":c}},23939:(e,t,r)=>{"use strict";r.d(t,{Z:()=>Z});var i=r(49977),o=r(409669),n=r.n(o),a=r(737691),s=r.n(a),l=r(430647),c=r(91175),p=r.n(c),u=r(227361),d=r.n(u),m=r(313311),f=r.n(m),g=r(701469),v=r.n(g),b=r(747037),y=r.n(b),x=r(513218),h=r.n(x),S=r(3674),w=r.n(S),O=r(493220),R=r.n(O),T=r(682492),M=r.n(T),C=r(546952),L=r(333101),F=r(504518),U=r(687753),P=r(917450),E=r(757660),W=r(134479),B=r(4143),A=r(707366),G=r(612912),D=r(175063),I=r(467763),$=r(351546),k=r(234228),V=r(399790),N=r(426529),j=r(859518),q=r(742178);const _=(e,t)=>e?i.Observable.of((0,F.vU)({title:"notification.warning",message:"catalog.notification.errorServiceUrl",autoDismiss:6,position:"tc"}),(0,C.Rc)(!1)):i.Observable.of((0,C.m)(t)),Z=e=>({recordSearchEpic:(t,r)=>t.ofType(C.V3).switchMap((t=>{let{format:o,url:n,startPosition:a,maxRecords:s,text:l,options:c}=t;const p=d()(c,"service.filter")||d()(c,"filter"),u=d()(c,"isNewService",!1);return i.Observable.defer((()=>e[o].textSearch(n,a,s,l,{options:c,filter:p,...(0,W.HN)(r.getState())}))).switchMap((e=>{if(e.error)return _(u,e);let t=i.Observable.empty();return u&&(t=i.Observable.from([(0,C.zX)(!0),(0,C.N3)(c.service),(0,F.Vp)({title:"notification.success",message:"catalog.notification.addCatalogService",autoDismiss:6,position:"tc"}),(0,C.Rc)(!1)])),t.concat([(0,C.nX)({url:n,startPosition:a,maxRecords:s,text:l},e)])})).startWith(u?(0,C.Rc)(!0):(0,C.K4)(!0)).catch((e=>_(u,e)))})),addLayersFromCatalogsEpic:(t,r)=>t.ofType(C.WX).filter((e=>{let{layers:t,sources:r}=e;return v()(t)&&v()(r)&&t.length&&t.length===r.length})).mergeMap((t=>{let{layers:o,sources:n,options:a,startPosition:s=1,maxRecords:l=4}=t;const c=r.getState(),u=(0,W.PG)(c),m=o.filter(((e,t)=>!!u[n[t]]||"object"==typeof n[t])).map(((t,r)=>{const p=d()(a,r,(0,W.bA)(c)),m=n[r],f="object"==typeof m?m:u[m],g=f.type.toLowerCase(),v=f.url,b=o[r];return i.Observable.defer((()=>e[g].textSearch(v,s,l,b,{...p,...f}).catch((()=>({results:[]}))))).map((e=>({...e,format:g,url:v,text:b,layerOptions:p})))}));return i.Observable.forkJoin(m).switchMap((t=>v()(t)&&t.length?i.Observable.of(t.map((t=>{const{format:r,url:o,text:n,layerOptions:a,...s}=t,l=(0,A.Ps)(c),u=e[r].getCatalogRecords(s,a,l)||[],d=p()(u.filter((e=>e.identifier||e.name===n))),{wms:m,wmts:f}=(0,D.tW)(d),g=m||f;if(g){const e=(0,D.n0)(g.SRS);if(g.SRS.length>0&&!$.default.isAllowedSRS("EPSG:3857",e))return i.Observable.empty()}const v=(0,W.kS)(c),b=e[r].getLayerFromRecord(d,{removeParams:v,catalogURL:"csw"===r&&o?o+"?request=GetRecordById&service=CSW&version=2.0.2&elementSetName=full&id="+d.identifier:o,layerBaseConfig:{}});return d?[b,a]:[n]}))):i.Observable.empty()))})).mergeMap((e=>{if(e){const t=e.filter((e=>y()(e[0]))).join(" ");let r=[];return t&&(r=[(0,C.E9)(t)]),r=[...r,...e.filter((e=>h()(e[0]))).map((e=>(0,C.A4)(M()({},e[0],e[1]))))],i.Observable.from(r)}return i.Observable.empty()})).catch((()=>i.Observable.empty())),addLayerAndDescribeEpic:(e,t)=>e.ofType(C.r7).mergeMap((e=>{const{layer:r,zoomToLayer:o}=e,n=[],a=t.getState(),s=(0,V.R8)(r);return n.push((0,L.A4)({...r,id:s})),o&&r.bbox&&n.push((0,j.Px)(r.bbox.bounds,r.bbox.crs)),"wms"===r.type?i.Observable.defer((()=>(0,I.gs)((0,V.Hi)(r),r.name))).switchMap((e=>{if(e){let t=f()(e,(e=>e.name===r.name));if(t&&"WFS"===t.owsType){const e=k.ZP.filterUrlParams(k.ZP.cleanDuplicatedQuestionMarks(t.owsURL),(0,W.kS)(a));return i.Observable.of((0,L.He)(s,{search:{url:e,type:"wfs"}}))}}return i.Observable.empty()})).merge(i.Observable.from(n)).catch((e=>i.Observable.of((0,C.bu)(r,e)))):i.Observable.from(n)})).catch((()=>i.Observable.empty())),newCatalogServiceAdded:(t,r)=>t.ofType(C.mh).switchMap((()=>{const t=r.getState(),o=(0,W._S)(t),n=(0,W.y)(t);return i.Observable.of(o).switchMap((t=>{var r,o;return(null===(r=e[t.type])||void 0===r||null===(o=r.preprocess)||void 0===o?void 0:o.call(r,t))??i.Observable.of(t)})).switchMap((t=>{var r,o;return(null===(r=e[t.type])||void 0===r||null===(o=r.validate)||void 0===o?void 0:o.call(r,t))??i.Observable.of(t)})).switchMap((e=>i.Observable.of((0,C.tt)({format:e.type,url:e.url,startPosition:1,maxRecords:n,text:"",options:{service:e,isNewService:!0}})))).catch((e=>i.Observable.of((0,F.vU)({exception:e,title:"notification.warning",message:e.notification||"catalog.notification.warningAddCatalogService",autoDismiss:6,position:"tc"}))))})),deleteCatalogServiceEpic:(e,t)=>e.ofType(C.$Y).switchMap((()=>{const e=t.getState();let r=(0,W.Cb)(e);const o=(0,W.b6)(e);let n=o[r]?(0,F.Vp)({title:"notification.warning",message:"catalog.notification.serviceDeletedCorrectly",autoDismiss:6,position:"tc"}):(0,F.vU)({title:"notification.warning",message:"catalog.notification.impossibleDeleteService",autoDismiss:6,position:"tc"}),a=(0,C.SU)(r);return o[r]?i.Observable.of(n,a):i.Observable.of(n)})),openCatalogEpic:(e,t)=>e.ofType(U.At,U.kM).filter((e=>"metadataexplorer"===e.control&&(0,W.JF)(t.getState()))).switchMap((()=>i.Observable.of((0,P.g)(),(0,P.aN)()))),getMetadataRecordById:(e,t)=>e.ofType(C.UT).switchMap((e=>{let{metadataOptions:r={}}=e;const o=t.getState(),a=(0,G.Iz)(o);return i.Observable.defer((()=>(0,I.FU)((0,V.Fh)(a)))).switchMap((e=>{const t=d()(e,"capability.layer.layer",[]),o=1===t.length?t[0].metadataURL:f()(t,(e=>e.name===a.name.split(":")[1])),c=d()(f()(o,(e=>y()(e.type)&&"iso19115:2003"===e.type.toLowerCase()&&("application/xml"===e.format||"text/xml"===e.format))),"onlineResource.href"),p=d()(f()(o,(e=>y()(e.type)&&"iso19115:2003"===e.type.toLowerCase()&&"text/html"===e.format)),"onlineResource.href"),u=f()(d()(r,"extractors",[]),(e=>{let{properties:t,layersRegex:r}=e;const i=r?new RegExp(r):null;return h()(t)&&(!r||i.test(a.name))})),m=p?{metadataUrl:p}:{},g=i.Observable.defer((()=>q.ZP.getRecordById(a.catalogURL))).switchMap((e=>e&&e.error?i.Observable.of((0,F.vU)({title:"notification.warning",message:"toc.layerMetadata.notification.warnigGetMetadataRecordById",autoDismiss:6,position:"tc"}),(0,L.c9)(m,!1)):e&&e.dc?i.Observable.of((0,L.c9)({...m,...e.dc},!1)):i.Observable.empty())),v=i.Observable.defer((()=>n().get(c,{headers:{Accept:"application/xml"}}))).pluck("data").map((e=>(new l.a).parseFromString(e))).map((e=>{const t=s().useNamespaces(r.xmlNamespaces||{}),i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;return R()(e).reduce(((e,o)=>{let n,[a,s]=o;if(h()(s)&&y()(s.xpath)&&h()(s.properties)&&w()(s.properties).length>0)n=t(s.xpath,r).map((e=>i(s.properties,e))),0===n.length&&(n=null);else{const e=t(s,r);1===e.length?n=d()(e[0],"nodeValue")??d()(e[0],"childNodes[0].nodeValue"):e.length>1&&(n=e.map((e=>d()(e,"childNodes[0].nodeValue"))).filter((e=>!!e)))}return{...e,...n?{[a]:n}:{}}}),{})};return i(u.properties,e)})).switchMap((e=>i.Observable.of((0,L.c9)({...m,...e},!1))));return c&&u?v:a.catalogURL?g:i.Observable.of((0,L.c9)(m,!1))})).startWith((0,L.c9)({},!0)).catch((()=>i.Observable.of((0,F.vU)({title:"notification.warning",message:"toc.layerMetadata.notification.warnigGetMetadataRecordById",autoDismiss:6,position:"tc"}),(0,L.c9)({},!1))))})),autoSearchEpic:function(e){let{getState:t=(()=>{})}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.ofType(C.CO).debounce((()=>{const e=t(),r=(0,W.l2)(e);return i.Observable.timer(r)})).switchMap((e=>{let{text:r}=e;const o=t(),n=(0,W.y)(o),a=(0,W.R7)(o),{type:s,url:l,filter:c}=a;return i.Observable.of((0,C.tt)({format:s,url:l,startPosition:1,maxRecords:n,text:r,options:{service:a,filter:c}}))}))},catalogCloseEpic:(e,t)=>e.ofType(C.ur).switchMap((()=>{const e=t.getState(),r=(0,B.YL)(e),o=(0,W.b6)(e);return i.Observable.of(...[(0,U.pu)("metadataexplorer","enabled",!1,"group",null),(0,C.In)("view"),(0,C.ye)()].concat("backgroundSelector"===r?[(0,C.Dw)(p()(w()(o))),(0,E.vw)(!0)]:[]))})),getSupportedFormatsEpic:function(e){let{getState:t=(()=>{})}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.ofType(C.xM).filter((e=>(0,W.CK)(t())!==(null==e?void 0:e.url))).switchMap((function(){let{url:e=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i.Observable.defer((()=>(0,I.T6)(e,!0))).switchMap((t=>i.Observable.of((0,C.nx)(t,e)))).let((0,N.hP)((0,C.We)(!0),(0,C.We)(!1),(()=>i.Observable.of((0,F.vU)({title:"layerProperties.format.error.title",message:"layerProperties.format.error.message"}),(0,C.We)(!1)))))}))},updateGroupSelectedMetadataExplorerEpic:(e,t)=>e.ofType(L.c7).filter((()=>(0,W.JF)(t.getState()))).switchMap((e=>{let{nodeType:r,id:o}=e;const n=t.getState(),a=0===(0,G.NP)(n).length||"group"!==r?"Default":o;return i.Observable.of((0,U.Xg)("metadataexplorer","group",a))}))})},175063:(e,t,r)=>{"use strict";r.d(t,{n0:()=>p,em:()=>u,tW:()=>d,FJ:()=>m,F8:()=>f,p8:()=>g,qy:()=>v});var i=r(727418),o=r.n(i),n=r(91175),a=r.n(n),s=r(701469),l=r.n(s),c=r(351546);const p=e=>e.filter((e=>c.default.isSRSAllowed(e))).reduce(((e,t)=>o()(e,{[t]:!0})),{}),u=(e,t)=>{const r=e.split("?"),i={};return r.length>=2&&r[1]&&r[1].split(/[&;]/g).forEach((e=>{const r=e.split("=");-1===t.indexOf(r[0].toLowerCase())&&(i[r[0]]=r[1])})),{url:r[0],params:i}},d=function(){let{references:e=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{wfs:a()(e.filter((e=>e.type&&("OGC:WFS"===e.type||e.type.indexOf("OGC:WFS")>-1&&e.type.indexOf("http-get-feature")>-1)))),wms:a()(e.filter((e=>e.type&&("OGC:WMS"===e.type||e.type.indexOf("OGC:WMS")>-1&&e.type.indexOf("http-get-map")>-1)))),wmts:a()(e.filter((e=>e.type&&("OGC:WMTS"===e.type||e.type.indexOf("OGC:WMTS")>-1&&e.type.indexOf("http-get-map")>-1)))),tms:a()(e.filter((e=>e.type&&("OGC:TMS"===e.type||e.type.indexOf("OGC:TMS")>-1))))}},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{references:[]};return{esri:a()(e.references.filter((e=>e.type&&("ESRI:SERVER"===e.type||"arcgis"===e.type))))}},f=function(){let{references:e=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=a()(e.filter((e=>e.type&&e.type.indexOf("OGC:WMS")>-1&&e.type.indexOf("http-get-capabilities")>-1))),r=a()(e.filter((e=>e.type&&e.type.indexOf("OGC:WFS")>-1&&e.type.indexOf("http-get-capabilities")>-1))),i=a()(e.filter((e=>e.type&&e.type.indexOf("OGC:WMTS")>-1&&e.type.indexOf("http-get-capabilities")>-1))),o=[];return t&&o.push({type:"WMS_GET_CAPABILITIES",url:t.url,labelId:"catalog.wmsGetCapLink"}),i&&o.push({type:"WMTS_GET_CAPABILITIES",url:i.url,labelId:"catalog.wmtsGetCapLink"}),r&&o.push({type:"WFS_GET_CAPABILITIES",url:r.url,labelId:"catalog.wfsGetCapLink"}),o},g=e=>"wms"===e.type?[e.url,...e.domainAliases??[]].join(","):e.url,v=e=>e&&!l()(e)&&-1!==e.indexOf(",")?e.split(",").map((e=>e.trim())):e}}]);